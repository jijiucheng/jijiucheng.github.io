---
layout: post
title: ã€iOSã€‘Fastlane è‡ªåŠ¨åŒ–æ‰“åŒ…ç¥å™¨ï¼ˆ2022.05.07 æ›´æ–°ï¼‰
categories: iOS
description: Fastlane è‡ªåŠ¨åŒ–æ‰“åŒ… TestFlightã€è’²å…¬è‹±ã€Fir.im å¹³å°
keywords: iOS, iOSé…ç½®, Fastlane, TestFlight
topmost: true
---

**å¯¼è¯»ï¼š** 
åœ¨è‡ªåŠ¨åŒ–æ‰“åŒ…çš„è·¯é€”ä¸­ï¼Œ`Fastlane` ç»å¯¹æ˜¯ç¥å™¨ä¸­çš„ç¥å™¨ã€‚

# fastlane

![Fastlane](/images/iOS/2022-05-07-Fastlane-01.png)

### fastlane ç›¸å…³èµ„æ–™

- [fastlane - å®˜æ–¹æ–‡æ¡£](https://docs.fastlane.tools/)
- [fastlane - iOS](https://docs.fastlane.tools/getting-started/ios/setup/)
- [fastlane - Appfile](https://docs.fastlane.tools/advanced/#appfile)
- [fastlane - actions](https://docs.fastlane.tools/actions)
- [fastlane - available plugins](https://docs.fastlane.tools/plugins/available-plugins)
- [Fastlane - plugins](https://docs.fastlane.tools/plugins/using-plugins/)
- []()
- [Homebrew Formulae - fastlane](https://formulae.brew.sh/formula/fastlane)
- [è’²å…¬è‹±å®˜ç½‘](https://www.pgyer.com/)
- [Fir.im - å®˜ç½‘](https://www.betaqr.com/)
- [Fir.im - å…³äº fir.im fastlane æ’ä»¶çš„ä¸€äº›è¯´æ˜](https://blog.betaqr.com/guan-yu-fastlane-cha-jian-wen-ti/)
- [Firim æ’ä»¶ï¼ˆéå®˜æ–¹ï¼‰](https://github.com/whlsxl/firim)
- [Firim æ’ä»¶ï¼ˆéå®˜æ–¹ï¼‰- fastlane](https://github.com/whlsxl/firim/tree/master/fastlane-plugin-firim)
- []()
- [æ˜é‡‘ - ä½¿ç”¨ fastlane å®ç°è‡ªåŠ¨åŒ–æ‰“åŒ…ï¼ˆæ¨èï¼‰](https://juejin.cn/post/6844903607343513608) 
- [æ˜é‡‘ - iOS+Fastlaneè‡ªåŠ¨æ‰“åŒ…å‘å¸ƒåˆ°TestFlight](https://juejin.cn/post/7021167923632799758)
- [æ˜é‡‘ - iOS+Fastlaneè‡ªåŠ¨æ‰“åŒ…å‘å¸ƒæµ‹è¯•ã€æ¶ˆæ¯é€šçŸ¥ï¼Œå®Œç¾ç»“åˆï¼](https://juejin.cn/post/7008553785672859656)
- [ç®€ä¹¦ - iOS(Swift) fastlaneé›†æˆ,åˆ†å‘è’²å…¬è‹±,fir(ä¸€)](https://www.jianshu.com/p/d9a3c42d9af0)
- [ç®€ä¹¦ - iOS(Swift) fastlaneé›†æˆ,å‘é€ testflight(äºŒ)](https://www.jianshu.com/p/e60b1d3e7c69)
- [ç®€ä¹¦ - iOSè‡ªåŠ¨åŒ–æ‰“åŒ…å‘å¸ƒï¼ˆFastlane + è’²å…¬è‹±ï¼‰](https://www.jianshu.com/p/2f25cb15ee12)
- [ç®€ä¹¦ - iOS Appé…ç½®å¤šç¯å¢ƒå˜é‡ + ä½¿ç”¨fastlaneå¿«é€Ÿæ‰“åŒ…å¹¶ä¸Šä¼ è’²å…¬è‹±/AppStore](https://www.jianshu.com/p/51fd90f97c8a)
- [ç®€ä¹¦ - iOS è‡ªåŠ¨åŒ–æ‰“åŒ…ï¼ˆfastlaneï¼‰ï¼ŒçœŸé¦™å®šå¾‹](https://www.jianshu.com/p/4f63e8c26af8)
- []()
- [å‚è€ƒèµ„æ–™ï¼šThere is a variety of ways to install Ruby without having to modify your system environment](https://www.ruby-lang.org/en/documentation/installation/#managers)
- [å‚è€ƒèµ„æ–™ï¼šPermission denied @ rb_sysopen - /Library/Ruby/Gems/2.3.0/cache/rack-2.0.4.gem](https://www.jianshu.com/p/64cfc0d78fe8)
- [å‚è€ƒèµ„æ–™ï¼šStackoverflow - iTunes Transporter error: Could not resolve module: com.apple.transporter.starterï¼ˆæœ‰æ•ˆï¼‰](https://stackoverflow.com/questions/70950473/itunes-transporter-error-could-not-resolve-module-com-apple-transporter-starte)
- [å‚è€ƒèµ„æ–™ï¼šApple Developer - Transporter error after home folder renamingï¼ˆæœ‰æ•ˆï¼‰](https://developer.apple.com/forums/thread/129378?answerId=419847022#419847022)
- [å‚è€ƒèµ„æ–™ï¼šStackoverflow - Fastlane upload_to_testflight The call to the iTMSTransporter completed with a non-zero exit status: 1. This indicates a failureï¼ˆæ— æ•ˆï¼‰](https://stackoverflow.com/questions/66059470/fastlane-upload-to-testflight-the-call-to-the-itmstransporter-completed-with-a-n)
- [å‚è€ƒèµ„æ–™ï¼šStackoverflow - Fabric Fastlane Pilot Upload iTMSTransporter failureï¼ˆæ— æ•ˆï¼‰](https://stackoverflow.com/questions/45189547/fabric-fastlane-pilot-upload-itmstransporter-failure)

### fastlane ç¯å¢ƒé…ç½®
#### é…ç½® Xcode command line tools (macOS)

`fastlane` åœ¨ `iOSç«¯` æ‰“åŒ…ï¼Œæ˜¯éœ€è¦ä¾æ‰˜äº `Xcode` çš„ `Xcode command line tools (macOS)` å·¥å…·çš„ï¼Œæ‰€ä»¥éœ€è¦æå‰å®‰è£…ï¼š

```swift
/// å®‰è£… Xcode command line tools æŒ‡ä»¤
xcode-select --install
```

å¦‚æœå‡ºç°å¦‚ä¸‹æŠ¥é”™ï¼Œåˆ™ä»£è¡¨å½“å‰å·²å®‰è£…äº† `Xcode command line tools (macOS)`ï¼Œæ— éœ€å†æ¬¡å®‰è£…ï¼š

```swift
/// å½“å‰å·²å®‰è£… Xcode command line tools å·¥å…·
xcode-select: error: command line tools are already installed, use "Software Update" to install updates
```

å¦‚æœç”µè„‘ä¸­å‡ºç°äº†å¤šä¸ª Xcodeï¼Œå¯èƒ½æœ‰æ—¶å€™è¿˜éœ€è¦é€‰æ‹©æŒ‡å®šçš„ Xcode è¿›è¡Œç¼–è¯‘æ‰“åŒ…ï¼š

```swift
/// æŸ¥è¯¢å½“å‰è·¯å¾„
xcode-select -p
/// é€‰æ‹©æŒ‡å®šè·¯å¾„
sudo xcode-select -s /Library/Developer/CommandLineTools/
```

#### å®‰è£… fastlane

å®˜æ–¹æä¾›äº†å¤šç§å®‰è£…æ–¹å¼ï¼Œåˆ†åˆ«æœ‰ï¼š
- `Managed Ruby environment + Bundler (macOS/Linux/Windows)ã€å®˜æ–¹æ¨èã€‘`
- `Homebrew (macOS)`
- `System Ruby + RubyGems (macOS/Linux/Windows)ã€å®˜æ–¹ä¸æ¨èã€‘`


**System Ruby + RubyGems (macOS/Linux/Windows)ã€å®˜æ–¹ä¸æ¨èã€‘**

```swift
/// è™½ç„¶å®˜æ–¹ä¸æ¨èï¼Œä½†æ˜¯ä»å¯ä»¥ä½¿ç”¨
sudo gem install fastlane
```

**Homebrew (macOS)**

- [å‚è€ƒèµ„æ–™ï¼šHomebrew Formulae - fastlane](https://formulae.brew.sh/formula/fastlane)

```swift
/// æŸ¥è¯¢å½“å‰ homebrew ç‰ˆæœ¬
brew -v
/// æ— éœ€å®‰è£… Rubyï¼Œä½†æ˜¯æ— æ³•è·¨å¹³å°
brew install fastlane
```

**Managed Ruby environment + Bundler (macOS/Linux/Windows)ã€å®˜æ–¹æ¨èã€‘**

- [å‚è€ƒèµ„æ–™ï¼šThere is a variety of ways to install Ruby without having to modify your system environment](https://www.ruby-lang.org/en/documentation/installation/#managers)

å®˜æ–¹å£°æ˜å¹¶ä¸æ¨èä½¿ç”¨ç³»ç»Ÿå†…ç½® `ï¼ˆsystem Rubyï¼‰` çš„ `Ruby`ï¼Œè€Œ `rbenv` åˆ™æ˜¯ç”¨æ¥ç®¡ç† ruby ç¯å¢ƒçš„å·¥å…·ï¼ˆ`rbenv is one of the most popular ways to manage your Ruby environment.`ï¼‰ã€‚

åŒæ—¶ fastlane è¦æ±‚ ruby ç¯å¢ƒå¿…é¡»æ˜¯ `2.5åŠä»¥ä¸Š` çš„ç‰ˆæœ¬ï¼ˆ`fastlane supports Ruby versions 2.5 or newer`ï¼‰ã€‚

```swift
/// æ£€æŸ¥ ruby ç‰ˆæœ¬
ruby --version
/// ruby 2.7.1p83 (2020-03-31 revision a0c7c23c9c) [x86_64-darwin19]
```

å®˜æ–¹æ¨èä½¿ç”¨ `Bundler + Gemfile` ç®¡ç† fastlane çš„ä¾èµ–é—®é¢˜ã€‚

```swift
/// å®‰è£… Bundler
gem install bundler
```

ç„¶ååœ¨é¡¹ç›®å·¥ç¨‹æ ¹ç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ª `Gemfile` æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š

```swift
source "https://rubygems.org"
gem "fastlane"
```

æ¥ç€æ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ï¼Œä¼šå¾—åˆ° `Gemfile` å’Œ `Gemfile.lock` ä¸¤ä¸ªæ–‡ä»¶ç”¨äºç®¡ç†ç‰ˆæœ¬ï¼š

```swift
/// æ‰§è¡Œè¿è¡ŒæŒ‡ä»¤
bundle update

/// ç¬¬ä¸€æ¬¡ç¼–è¯‘
bundle install
/// æ›´æ–° fastlane
bundle update fastlane
```

å†ä¹‹åï¼Œåˆ™æ ¹æ®éœ€æ±‚æ‰§è¡Œå¯¹åº”çš„ `lane action` æ–¹æ³•ï¼š

```swift
/// æ‰§è¡Œ lane action
bundle exec fastlane xxx
```

#### fastlane åˆå§‹åŒ–

`cd` åˆ°é¡¹ç›®æ ¹ç›®å½•ï¼Œæ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ï¼š

```swift
fastlane init
```

ä¼šå¾—åˆ°å¦‚ä¸‹ç»“æœï¼ŒåŒæ—¶æ ¹ç›®å½•ä¸‹ä¼šäº§ç”Ÿä¸€ä¸ª `fastlane` æ–‡ä»¶å¤¹ï¼š

```swift
{22-05-05 17:53}mxgx:~/FastlaneDemo@devâœ—âœ—âœ—âœ—âœ—âœ— mxgx% fastlane init
[âœ”] ğŸš€ 
[âœ”] Looking for iOS and Android projects in current directory...
[17:53:37]: Created new folder './fastlane'.
[17:53:37]: Detected an iOS/macOS project in the current directory: 'FastlaneDemo.xcworkspace'
[17:53:37]: -----------------------------
[17:53:37]: --- Welcome to fastlane ğŸš€ ---
[17:53:37]: -----------------------------
[17:53:37]: fastlane can help you with all kinds of automation for your mobile app
[17:53:37]: We recommend automating one task first, and then gradually automating more over time
[17:53:37]: What would you like to use fastlane for?
1. ğŸ“¸  Automate screenshots
2. ğŸ‘©â€âœˆï¸  Automate beta distribution to TestFlight
3. ğŸš€  Automate App Store distribution
4. ğŸ›   Manual setup - manually setup your project to automate your tasks
?  4
[17:55:29]: ------------------------------------------------------------
[17:55:29]: --- Setting up fastlane so you can manually configure it ---
[17:55:29]: ------------------------------------------------------------
[17:55:29]: --------------------------------------------------------
[17:55:29]: --- âœ…  Successfully generated fastlane configuration ---
[17:55:29]: --------------------------------------------------------
[17:55:29]: Generated Fastfile at path `./fastlane/Fastfile`
[17:55:29]: Generated Appfile at path `./fastlane/Appfile`
[17:55:29]: Gemfile and Gemfile.lock at path `Gemfile`
[17:55:29]: Please check the newly generated configuration files into git along with your project
[17:55:29]: This way everyone in your team can benefit from your fastlane setup
[17:55:29]: Continue by pressing Enter â

[17:55:36]: fastlane will collect the number of errors for each action to detect integration issues
[17:55:36]: No sensitive/private information will be uploaded, more information: https://docs.fastlane.tools/#metrics
[17:55:36]: ----------------------
[17:55:36]: --- fastlane lanes ---
[17:55:36]: ----------------------
[17:55:36]: fastlane uses a `Fastfile` to store the automation configuration
[17:55:36]: Within that, you'll see different lanes.
[17:55:36]: Each is there to automate a different task, like screenshots, code signing, or pushing new releases
[17:55:36]: Continue by pressing Enter â

[17:55:52]: --------------------------------------
[17:55:52]: --- How to customize your Fastfile ---
[17:55:52]: --------------------------------------
[17:55:52]: Use a text editor of your choice to open the newly created Fastfile and take a look
[17:55:52]: You can now edit the available lanes and actions to customize the setup to fit your needs
[17:55:52]: To get a list of all the available actions, open https://docs.fastlane.tools/actions
[17:55:52]: Continue by pressing Enter â

[17:55:54]: ------------------------------
[17:55:54]: --- Where to go from here? ---
[17:55:54]: ------------------------------
[17:55:54]: ğŸ“¸  Learn more about how to automatically generate localized App Store screenshots:
[17:55:54]: 		https://docs.fastlane.tools/getting-started/ios/screenshots/
[17:55:54]: ğŸ‘©â€âœˆï¸  Learn more about distribution to beta testing services:
[17:55:54]: 		https://docs.fastlane.tools/getting-started/ios/beta-deployment/
[17:55:54]: ğŸš€  Learn more about how to automate the App Store release process:
[17:55:54]: 		https://docs.fastlane.tools/getting-started/ios/appstore-deployment/
[17:55:54]: ğŸ‘©â€âš•ï¸  Learn more about how to setup code signing with fastlane
[17:55:54]: 		https://docs.fastlane.tools/codesigning/getting-started/
[17:55:54]: 
[17:55:54]: To try your new fastlane setup, just enter and run
[17:55:54]: $ fastlane custom_lane
```

æ­¤æ—¶ä»£è¡¨åˆå§‹åŒ–æˆåŠŸäº†ï¼ŒåŒæ—¶ `fastlane` æ–‡ä»¶å¤¹ä¸‹ä¼šå¤šå‡ºä¸¤ä¸ªæ–‡ä»¶ `Appfile` å’Œ `Fastfile` ç”¨æ¥è‡ªå®šä¹‰é…ç½®çš„ã€‚

æ­¤å¤„ä»‹ç»ä¸€ä¸‹ï¼š

```swift
/// ä½¿ç”¨ fastlane åšä»€ä¹ˆï¼Ÿ
[17:53:37]: What would you like to use fastlane for?
/// é€‰é¡¹1ï¼šè‡ªåŠ¨æˆªå±ï¼Œèƒ½å¸®æˆ‘ä»¬è‡ªåŠ¨æˆªå– APP ä¸­çš„æˆªå›¾ï¼Œå¹¶æ·»åŠ æ‰‹æœºè¾¹æ¡†ï¼ˆå¦‚æœéœ€è¦çš„è¯ï¼‰
1. ğŸ“¸  Automate screenshots
/// é€‰é¡¹2ï¼šè‡ªåŠ¨å‘å¸ƒ beta ç‰ˆæœ¬ç”¨äº TestFlight
2. ğŸ‘©â€âœˆï¸  Automate beta distribution to TestFlight
/// é€‰é¡¹3ï¼šè‡ªåŠ¨å‘å¸ƒåˆ° AppStore
3. ğŸš€  Automate App Store distribution
/// é€‰é¡¹4ï¼šæ‰‹åŠ¨é…ç½®ï¼ˆè²Œä¼¼å½“ä¸‹æ‰€æœ‰çš„æ•™ç¨‹éƒ½æ˜¯é»˜è®¤é€‰è¿™ä¸ªçš„ï¼‰
4. ğŸ›   Manual setup - manually setup your project to automate your tasks
?  4
```

#### fastlane æ‰‹åŠ¨é…ç½®

##### Appfile

- [å‚è€ƒèµ„æ–™ï¼šFastlane - Appfile](https://docs.fastlane.tools/advanced/#appfile)

```swift
/// Bundle Identifier
app_identifier "Bundle Identifier"
/// å¼€å‘è€…è´¦æˆ· AppleID å¯¹åº”çš„é‚®ç®±
apple_id "å¼€å‘è€… AppleID é‚®ç®±"
/// TeamIDï¼šå¯ä»¥é€šè¿‡ KeyChain ä¸­çš„ .cer è¯ä¹¦æ–‡ä»¶ä¸­æ˜¾ç¤º () æ‹¬å·ä¸­çš„åä½å­—ç¬¦ä¸²ï¼Œä½†æ˜¯çœ‹å®˜æ–¹æ•™ç¨‹ï¼Œå¹¶æ²¡æœ‰æ·»åŠ æ­¤é¡¹
team_id "xxxx"
```

##### Fastfile

- [å‚è€ƒèµ„æ–™ï¼šFastlane - actions](https://docs.fastlane.tools/actions)
- [å‚è€ƒèµ„æ–™ï¼šFastlane - available plugins](https://docs.fastlane.tools/plugins/available-plugins)

```swift
/// Fastfile - æ‰“åŒ… + å‘å¸ƒ testflight + pgyer + firim
# update_fastlane
default_platform(:ios)
platform :ios do 
  # æ‰“åŒ… + å‘å¸ƒ testflight + pgyer + firim
  desc "Push a new build to TestFlightã€pgyerã€fir.im."
  lane :release_all do
    release_gym
    upload_testflight
    upload_pgyer
    upload_firim
  end

  # æ‰“åŒ… + å‘å¸ƒ testflight
  desc "Push a new build to TestFlight."
  lane :release_testflight do
    release_gym
    upload_testflight
  end

  # æ‰“åŒ… + å‘å¸ƒ pgyer
  desc "Push a new build to Pgyer."
  lane :release_pgyer do
    release_gym
    upload_pgyer
  end

  # æ‰“åŒ… + å‘å¸ƒ firim
  desc "Push a new build to Fir.im."
  lane :release_firim do
    release_gym
    upload_firim
  end

  # æ‰“åŒ…
  desc "Push a new build to gym."
  lane :release_gym do
    puts "--- ã€Noticeã€‘gym start -------------------------"
    gym(
      clean: true,
      output_directory: "./fastlane/package",
      scheme: "JJCComicBook",
      workspace: "JJCComicBook.xcworkspace",
      configuration: "Release",
      export_method: "app-store",
      export_options: {iCloudContainerEnvironment: "Production"},
      export_xcargs: "-allowProvisioningUpdates"
    )
    puts "--- ã€Noticeã€‘gym end -------------------------"

    # macä¸Šçš„é€šçŸ¥å¼¹çª—ï¼Œé€šçŸ¥æ‰“åŒ…å®Œæ¯•
    notification(app_icon: "./fastlane/icon.png", title: "è‹œè“¿æ¼«ç”»", subtitle: "æ‰“åŒ…æˆåŠŸï¼Œå·²å¯¼å‡ºå®‰è£…åŒ…", message: "å‡†å¤‡å‘å¸ƒä¸­â€¦â€¦")
  end

  # ä¸Šä¼ åˆ° TestFlight
  desc "Push a new build to upload TestFlight."
  lane :upload_testflight do
    puts "--- ã€Noticeã€‘upload testflight start -------------------------"
    updateVersionDes = "è‹œè“¿è‹œè“¿_v2.0.4(2)\n1ã€ä¿®å¤éƒ¨åˆ†æ¼«æºå¤±æ•ˆé—®é¢˜ï¼›\n2ã€ä¼˜åŒ–ç»†èŠ‚é—®é¢˜ã€‚"
    api_key = app_store_connect_api_key(
      key_id: "7Z7YBJ8T4S", 
      issuer_id: "5313c630-7018-45ac-96e3-8bed54f2af68",
      key_filepath: "./fastlane/JJCComicBook_API_Key_Developer.p8",
      duration: 1200,
      in_house: false
    )
    upload_to_testflight(
      api_key: api_key,
      skip_waiting_for_build_processing: true,
      # username: "jijiucheng666@163.com",
      # app_identifier: "com.jijiucheng.JJCComicBook",
      ipa: "./fastlane/package/JJCComicBook.ipa",
      skip_submission:true,
      beta_app_description: updateVersionDes
    )
    puts "--- ã€Noticeã€‘upload testflight end -------------------------"
  end

  # ä¸Šä¼ åˆ°è’²å…¬è‹±å‘å¸ƒå¹³å°
  desc "Push a new build to upload Pgyer."
  lane :upload_pgyer do
    puts "--- ã€Noticeã€‘upload pgyer start -------------------------"
    updateVersionDes = "è‹œè“¿è‹œè“¿_v2.0.4(2)\n1ã€ä¿®å¤éƒ¨åˆ†æ¼«æºå¤±æ•ˆé—®é¢˜ï¼›\n2ã€ä¼˜åŒ–ç»†èŠ‚é—®é¢˜ã€‚"
    pgyer(
      api_key: "effa09759cb507ece7ff7c791d3528f8",
      user_key: "8079af61ce98d89172e0aa5318f935c5",
      update_description: updateVersionDes
    )
    puts "--- ã€Noticeã€‘upload pgyer end -------------------------"
  end

  # ä¸Šä¼ åˆ° fir.im å‘å¸ƒå¹³å°
  desc "Push a new build to upload Fir.im."
  lane :upload_firim do
    puts "--- ã€Noticeã€‘upload fir.im start -------------------------"
    updateVersionDes = "è‹œè“¿è‹œè“¿_v2.0.4(2)\n1ã€ä¿®å¤éƒ¨åˆ†æ¼«æºå¤±æ•ˆé—®é¢˜ï¼›\n2ã€ä¼˜åŒ–ç»†èŠ‚é—®é¢˜ã€‚"
    fir_cli(
      api_token: "df347b91ebcfccd894b6b176f410f061", 
      changelog: updateVersionDes
    )
    puts "--- ã€Noticeã€‘upload fir.im end -------------------------"
  end
end
```

```Swift
/// Fastfile 
# update_fastlane
default_platform(:ios)
platform :ios do 
  # æ‰“åŒ… + å‘å¸ƒ testflight + pgyer + firim
  desc "Push a new build to TestFlightã€pgyerã€fir.im."
  lane :release_all do
    release_gym
    upload_testflight
    upload_pgyer
    upload_firim
  end

  # æ‰“åŒ… + å‘å¸ƒ testflight
  desc "Push a new build to TestFlight."
  lane :release_testflight do
    release_gym
    upload_testflight
  end

  # æ‰“åŒ… + å‘å¸ƒ pgyer
  desc "Push a new build to Pgyer."
  lane :release_pgyer do
    release_gym
    upload_pgyer
  end

  # æ‰“åŒ… + å‘å¸ƒ firim
  desc "Push a new build to Fir.im."
  lane :release_firim do
    release_gym
    upload_firim
  end

  # æ‰“åŒ…
  desc "Push a new build to gym."
  lane :release_gym do
    puts "--- ã€Noticeã€‘gym start -------------------------"
    gym(
      # æ¯æ¬¡ç¼–è¯‘æ‰“åŒ…å‰æ˜¯å¦è¿›è¡Œæ¸…ç†ç¼“å­˜
      clean: true,
      # è¾“å‡º .ipa åŒ…æ–‡ä»¶è·¯å¾„
      output_directory: "./fastlane/package",
      # é¡¹ç›®å·¥ç¨‹åç§°ï¼Œå¦‚æœè®¾å®šå¤šä¸ª scheme çš„æ—¶å€™ï¼Œè¯¥å‚æ•°ä¼šä¸åŒ
      scheme: "JJCComicBook",
      # # è¾“å‡ºçš„ ipa åç§°ï¼Œå¯ä»¥ä¸æ·»åŠ ï¼Œä¼šé»˜è®¤æ ¹æ® scheme æ¥ç¡®å®š
      # output_name:"JJCComicBook.ipa",
      # å¦‚æœé¡¹ç›®ä¸­ä½¿ç”¨äº† Cocoapods éœ€è¦æ·»åŠ æ­¤å‚æ•°
      workspace: "JJCComicBook.xcworkspace",
      # é…ç½®æ‰“åŒ…ç¯æ–¹å¼ï¼ŒReleaseã€Debugã€Testã€PreRelease
      configuration: "Release",
      # é…ç½®æ‰“åŒ…è¾“å‡ºæ–¹å¼ï¼Œç›®å‰æ”¯æŒï¼šapp-storeã€packageã€ad-hocã€enterpriseã€development
      export_method: "app-store",
      # # åœ¨æ„å»ºæ—¶éšè—ç»ˆç«¯ä¸å¿…è¦è¾“å‡ºçš„ä¿¡æ¯
      # silent: false,
      # å…¶ä»–é…ç½®ä¿¡æ¯
      # å½“é¡¹ç›®ä¸­ä½¿ç”¨äº† iCloud çš„æ—¶å€™ï¼Œéœ€è¦æ·»åŠ  iCloudContainerEnvironment å‚æ•°ï¼Œå‚æ•°å€¼æœ‰ Productionã€Development
      export_options: {iCloudContainerEnvironment: "Production"},
      # å¦‚æœæœ‰å¤šä¸ªå‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨ xcargs: ["xxx", "xxx"] çš„æ–¹å¼
      export_xcargs: "-allowProvisioningUpdates"
    )
    puts "--- ã€Noticeã€‘gym end -------------------------"

    # macä¸Šçš„é€šçŸ¥å¼¹çª—ï¼Œé€šçŸ¥æ‰“åŒ…å®Œæ¯•
    notification(app_icon: "./fastlane/icon.png", title: "è‹œè“¿æ¼«ç”»", subtitle: "æ‰“åŒ…æˆåŠŸï¼Œå·²å¯¼å‡ºå®‰è£…åŒ…", message: "å‡†å¤‡å‘å¸ƒä¸­â€¦â€¦")
  end

  # ä¸Šä¼ åˆ° TestFlight
  desc "Push a new build to upload TestFlight."
  lane :upload_testflight do
    puts "--- ã€Noticeã€‘upload testflight start -------------------------"
    updateVersionDes = "è‹œè“¿è‹œè“¿_v2.0.4(2)\n1ã€ä¿®å¤éƒ¨åˆ†æ¼«æºå¤±æ•ˆé—®é¢˜ï¼›\n2ã€ä¼˜åŒ–ç»†èŠ‚é—®é¢˜ã€‚"
    api_key = app_store_connect_api_key(
      # AppStore Connect å¯†é’¥ç›¸å…³å‚æ•°
      key_id: "7Z7YBJ8T4S", 
      issuer_id: "5313c630-7018-45ac-96e3-8bed54f2af68",
      # å¯†é’¥æ–‡ä»¶è·¯å¾„
      key_filepath: "./fastlane/JJCComicBook_API_Key_Developer.p8",
      # å¯é€‰ï¼Œæœ€å¤§å€¼ = 1200
      duration: 1200,
      # å¯é€‰ï¼Œbut may be required if using match/sigh
      in_house: false
    )
    upload_to_testflight(
      api_key: api_key,
      skip_waiting_for_build_processing: true,
      # # usernameã€app_identifier å’Œ api_key ä¸èƒ½åŒæ—¶å­˜åœ¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™
      # username: "jijiucheng666@163.com",
      # app_identifier: "com.jijiucheng.JJCComicBook",
      # è¦ä¸Šä¼ åˆ° testflight çš„åŒ…è·¯å¾„
      ipa: "./fastlane/package/JJCComicBook.ipa",
      # æ˜¯å¦å¿½ç•¥ç›´æ¥æäº¤å®¡æ ¸
      skip_submission:true,
      # 
      beta_app_description: updateVersionDes
    )
    puts "--- ã€Noticeã€‘upload testflight end -------------------------"
  end

  # ä¸Šä¼ åˆ°è’²å…¬è‹±å‘å¸ƒå¹³å°
  desc "Push a new build to upload Pgyer."
  lane :upload_pgyer do
    puts "ã€Noticeã€‘upload pgyer start -------------------------"
    updateVersionDes = "è‹œè“¿è‹œè“¿_v2.0.4(2)\n1ã€ä¿®å¤éƒ¨åˆ†æ¼«æºå¤±æ•ˆé—®é¢˜ï¼›\n2ã€ä¼˜åŒ–ç»†èŠ‚é—®é¢˜ã€‚"
    pgyer(
      api_key: "effa09759cb507ece7ff7c791d3528f8",
      user_key: "8079af61ce98d89172e0aa5318f935c5",
      update_description: updateVersionDes
    )
    puts "--- ã€Noticeã€‘upload pgyer end -------------------------"
  end

  # ä¸Šä¼ åˆ° fir.im å‘å¸ƒå¹³å°
  desc "Push a new build to upload Fir.im."
  lane :upload_firim do
    puts "--- ã€Noticeã€‘upload fir.im start -------------------------"
    updateVersionDes = "è‹œè“¿è‹œè“¿_v2.0.4(2)\n1ã€ä¿®å¤éƒ¨åˆ†æ¼«æºå¤±æ•ˆé—®é¢˜ï¼›\n2ã€ä¼˜åŒ–ç»†èŠ‚é—®é¢˜ã€‚"
    fir_cli(
      api_token: "df347b91ebcfccd894b6b176f410f061", 
      changelog: updateVersionDes
    )
    puts "--- ã€Noticeã€‘upload fir.im end -------------------------"
  end
end
```

æ‰“åŒ…æˆåŠŸï¼š

```swift
bundle exec fastlane export_ipa
[âœ”] ğŸš€ 
[18:34:01]: ------------------------------
[18:34:01]: --- Step: default_platform ---
[18:34:01]: ------------------------------
[18:34:01]: Driving the lane 'ios export_ipa' ğŸš€
[18:34:01]: -----------------
[18:34:01]: --- Step: gym ---
[18:34:01]: -----------------
[18:34:01]: Resolving Swift Package Manager dependencies...
...
...
...
+--------------------------------------+-----------------------------------------------------+
|                                  Summary for gym 2.205.2                                   |
+--------------------------------------+-----------------------------------------------------+
| clean                                | true                                                |
| output_directory                     | ./fastlane/package                                  |
| scheme                               | JJCComicBook                                        |
| workspace                            | JJCComicBook.xcworkspace                            |
| configuration                        | Release                                             |
| export_method                        | app-store                                           |
| output_name                          | JJCComicBook                                        |
| silent                               | false                                               |
| skip_package_ipa                     | false                                               |
| skip_package_pkg                     | false                                               |
| build_path                           | /Users/mxgx/Library/Developer/Xcode/Archives/2022-  |
|                                      | 05-05                                               |
| result_bundle                        | false                                               |
| buildlog_path                        | ~/Library/Logs/gym                                  |
| destination                          | generic/platform=iOS                                |
| xcodebuild_formatter                 | xcpretty                                            |
| skip_profile_detection               | false                                               |
| xcodebuild_command                   | xcodebuild                                          |
| skip_package_dependencies_resolution | false                                               |
| disable_package_automatic_updates    | false                                               |
| use_system_scm                       | false                                               |
| xcode_path                           | /Applications/Xcode.app                             |
+--------------------------------------+-----------------------------------------------------+
...
...
...
[18:38:30]: Successfully exported and compressed dSYM file
[18:38:30]: Successfully exported and signed the ipa file:
[18:38:30]: /Users/mxgx/Documents/GitHub/JJCComicBook/Code/JJCComicBook/fastlane/package/JJCComicBook.ipa

+------+------------------+-------------+
|           fastlane summary            |
+------+------------------+-------------+
| Step | Action           | Time (in s) |
+------+------------------+-------------+
| 1    | default_platform | 0           |
| 2    | gym              | 269         |
+------+------------------+-------------+

[18:38:30]: fastlane.tools finished successfully ğŸ‰
```

![Fastlane - æ‰“åŒ…ä¿¡æ¯](/images/iOS/2022-05-07-Fastlane-02.png)
![Fastlane - æ‰“åŒ…æˆåŠŸæ ‡è¯† 01](/images/iOS/2022-05-07-Fastlane-03.png)
![Fastlane - æ‰“åŒ…æˆåŠŸæ ‡è¯† 02](/images/iOS/2022-05-07-Fastlane-04.png)

### Fastlane Actions

```swift
+----------------------------------+----------------------------------+------------------+
|                               Available fastlane actions                               |
+----------------------------------+----------------------------------+------------------+
| Action                           | Description                      | Author           |
+----------------------------------+----------------------------------+------------------+
| adb                              | Run ADB Actions                  | hjanuschka       |
| adb_devices                      | Get an array of Connected        | hjanuschka       |
|                                  | android device serials           |                  |
| add_extra_platforms              | Modify the default list of       | lacostej         |
|                                  | supported platforms              |                  |
| add_git_tag                      | This will add an annotated git   | Multiple         |
|                                  | tag to the current branch        |                  |
| app_store_build_number           | Returns the current              | hjanuschka       |
|                                  | build_number of either live or   |                  |
|                                  | edit version                     |                  |
| app_store_connect_api_key        | Load the App Store Connect API   | joshdholtz       |
|                                  | token to use in other fastlane   |                  |
|                                  | tools and actions                |                  |
| appaloosa                        | Upload your app to "Appaloosa    | Appaloosa        |
|                                  | Store"                           |                  |
|                                  | (https://www.appaloosa-store.co  |                  |
|                                  | m/ ğŸ”—)                           |                  |
| appetize                         | Upload your app to               | Multiple         |
|                                  | "Appetize.io"                    |                  |
|                                  | (https://appetize.io/ ğŸ”—) to     |                  |
|                                  | stream it in browser             |                  |
| appetize_viewing_url_generator   | Generate an URL for appetize     | KrauseFx         |
|                                  | simulator                        |                  |
| appium                           | Run UI test by Appium with       | yonekawa         |
|                                  | RSpec                            |                  |
| appledoc                         | Generate Apple-like source code  | alexmx           |
|                                  | documentation from the source    |                  |
|                                  | code                             |                  |
| appstore                         | Alias for the                    | KrauseFx         |
|                                  | `upload_to_app_store` action     |                  |
| apteligent                       | Upload dSYM file to "Apteligent  | Mo7amedFouad     |
|                                  | (Crittercism)"                   |                  |
|                                  | (http://www.apteligent.com/ ğŸ”—)  |                  |
| artifactory                      | This action uploads an artifact  | Multiple         |
|                                  | to artifactory                   |                  |
| automatic_code_signing           | Configures Xcode's Codesigning   | Multiple         |
| (DEPRECATED)                     | options                          |                  |
| backup_file                      | This action backs up your file   | gin0606          |
|                                  | to "[path].back"                 |                  |
| backup_xcarchive                 | Save your [zipped] xcarchive     | dral3x           |
|                                  | elsewhere from default path      |                  |
| badge (DEPRECATED)               | Automatically add a badge to     | DanielGri        |
|                                  | your app icon                    |                  |
| build_and_upload_to_appetize     | Generate and upload an ipa file  | KrauseFx         |
|                                  | to appetize.io                   |                  |
| build_android_app                | Alias for the `gradle` action    | Multiple         |
| build_app                        | Easily build and sign your app   | KrauseFx         |
|                                  | (via _gym_)                      |                  |
| build_ios_app                    | Alias for the `build_app`        | KrauseFx         |
|                                  | action but only for iOS          |                  |
| build_mac_app                    | Alias for the `build_app`        | KrauseFx         |
|                                  | action but only for macOS        |                  |
| bundle_install                   | This action runs `bundle         | Multiple         |
|                                  | install` (if available)          |                  |
| capture_android_screenshots      | Automated localized screenshots  | Multiple         |
|                                  | of your Android app (via         |                  |
|                                  | _screengrab_)                    |                  |
| capture_ios_screenshots          | Generate new localized           | KrauseFx         |
|                                  | screenshots on multiple devices  |                  |
|                                  | (via _snapshot_)                 |                  |
| capture_screenshots              | Alias for the                    | KrauseFx         |
|                                  | `capture_ios_screenshots`        |                  |
|                                  | action                           |                  |
| carthage                         | Runs `carthage` for your         | Multiple         |
|                                  | project                          |                  |
| cert                             | Alias for the                    | KrauseFx         |
|                                  | `get_certificates` action        |                  |
| changelog_from_git_commits       | Collect git commit messages      | Multiple         |
|                                  | into a changelog                 |                  |
| chatwork                         | Send a success/error message to  | astronaughts     |
|                                  | "ChatWork"                       |                  |
|                                  | (https://go.chatwork.com/ ğŸ”—)    |                  |
| check_app_store_metadata         | Check your app's metadata        | taquitos         |
|                                  | before you submit your app to    |                  |
|                                  | review (via _precheck_)          |                  |
| clean_build_artifacts            | Deletes files created as result  | lmirosevic       |
|                                  | of running gym, cert, sigh or    |                  |
|                                  | download_dsyms                   |                  |
| clean_cocoapods_cache            | Remove the cache for pods        | alexmx           |
| clear_derived_data               | Deletes the Xcode Derived Data   | KrauseFx         |
| clipboard                        | Copies a given string into the   | Multiple         |
|                                  | clipboard. Works only on macOS   |                  |
| cloc                             | Generates a Code Count that can  | intere           |
|                                  | be read by Jenkins (xml format)  |                  |
| cocoapods                        | Runs `pod install` for the       | Multiple         |
|                                  | project                          |                  |
| commit_github_file               | This will commit a file          | tommeier         |
|                                  | directly on GitHub via the API   |                  |
| commit_version_bump              | Creates a 'Version Bump'         | lmirosevic       |
|                                  | commit. Run after                |                  |
|                                  | `increment_build_number`         |                  |
| copy_artifacts                   | Copy and save your build         | lmirosevic       |
|                                  | artifacts (useful when you use   |                  |
|                                  | reset_git_repo)                  |                  |
| create_app_on_managed_play_stor  | Create Managed Google Play Apps  | janpio           |
| e                                |                                  |                  |
| create_app_online                | Creates the given application    | KrauseFx         |
|                                  | on iTC and the Dev Portal (via   |                  |
|                                  | _produce_)                       |                  |
| create_keychain                  | Create a new Keychain            | gin0606          |
| create_pull_request              | This will create a new pull      | Multiple         |
|                                  | request on GitHub                |                  |
| create_xcframework               | Package multiple build configs   | jgongo           |
|                                  | of a library/framework into a    |                  |
|                                  | single xcframework               |                  |
| danger                           | Runs `danger` for the project    | KrauseFx         |
| debug                            | Print out an overview of the     | KrauseFx         |
|                                  | lane context values              |                  |
| default_platform                 | Defines a default platform to    | KrauseFx         |
|                                  | not have to specify the          |                  |
|                                  | platform                         |                  |
| delete_keychain                  | Delete keychains and remove      | Multiple         |
|                                  | them from the search list        |                  |
| deliver                          | Alias for the                    | KrauseFx         |
|                                  | `upload_to_app_store` action     |                  |
| deploygate                       | Upload a new build to            | Multiple         |
|                                  | "DeployGate"                     |                  |
|                                  | (https://deploygate.com/ ğŸ”—)     |                  |
| dotgpg_environment               | Reads in production secrets set  | simonlevy5       |
|                                  | in a dotgpg file and puts them   |                  |
|                                  | in ENV                           |                  |
| download                         | Download a file from a remote    | KrauseFx         |
|                                  | server (e.g. JSON file)          |                  |
| download_app_privacy_details_fr  | Download App Privacy Details     | igor-makarov     |
| om_app_store                     | from an app in App Store         |                  |
|                                  | Connect                          |                  |
| download_dsyms                   | Download dSYM files from App     | KrauseFx         |
|                                  | Store Connect for Bitcode apps   |                  |
| download_from_play_store         | Download metadata and binaries   | janpio           |
|                                  | from Google Play (via _supply_)  |                  |
| dsym_zip                         | Creates a zipped dSYM in the     | lmirosevic       |
|                                  | project root from the            |                  |
|                                  | .xcarchive                       |                  |
| echo                             | Alias for the `puts` action      | KrauseFx         |
| ensure_bundle_exec               | Raises an exception if not       | rishabhtayal     |
|                                  | using `bundle exec` to run       |                  |
|                                  | fastlane                         |                  |
| ensure_env_vars                  | Raises an exception if the       | revolter         |
|                                  | specified env vars are not set   |                  |
| ensure_git_branch                | Raises an exception if not on a  | Multiple         |
|                                  | specific git branch              |                  |
| ensure_git_status_clean          | Raises an exception if there     | Multiple         |
|                                  | are uncommitted git changes      |                  |
| ensure_no_debug_code             | Ensures the given text is        | KrauseFx         |
|                                  | nowhere in the code base         |                  |
| ensure_xcode_version             | Ensure the right version of      | Multiple         |
|                                  | Xcode is used                    |                  |
| environment_variable             | Sets/gets env vars for           | taquitos         |
|                                  | Fastlane.swift. Don't use in     |                  |
|                                  | ruby, use `ENV[key] = val`       |                  |
| erb                              | Allows to Generate output files  | hjanuschka       |
|                                  | based on ERB templates           |                  |
| fastlane_version                 | Alias for the                    | KrauseFx         |
|                                  | `min_fastlane_version` action    |                  |
| flock                            | Send a message to a "Flock"      | Manav            |
|                                  | (https://flock.com/ ğŸ”—) group    |                  |
| frame_screenshots                | Adds device frames around all    | KrauseFx         |
|                                  | screenshots (via _frameit_)      |                  |
| frameit                          | Alias for the                    | KrauseFx         |
|                                  | `frame_screenshots` action       |                  |
| gcovr                            | Runs test coverage reports for   | dtrenz           |
|                                  | your Xcode project               |                  |
| get_build_number                 | Get the build number of your     | Liquidsoul       |
|                                  | project                          |                  |
| get_build_number_repository      | Get the build number from the    | Multiple         |
|                                  | current repository               |                  |
| get_certificates                 | Create new iOS code signing      | KrauseFx         |
|                                  | certificates (via _cert_)        |                  |
| get_github_release               | This will verify if a given      | Multiple         |
|                                  | release version is available on  |                  |
|                                  | GitHub                           |                  |
| get_info_plist_value             | Returns value from Info.plist    | kohtenko         |
|                                  | of your project as native Ruby   |                  |
|                                  | data structures                  |                  |
| get_ipa_info_plist_value         | Returns a value from Info.plist  | johnboiles       |
|                                  | inside a .ipa file               |                  |
| get_managed_play_store_publishi  | Obtain publishing rights for     | janpio           |
| ng_rights                        | custom apps on Managed Google    |                  |
|                                  | Play Store                       |                  |
| get_provisioning_profile         | Generates a provisioning         | KrauseFx         |
|                                  | profile, saving it in the        |                  |
|                                  | current folder (via _sigh_)      |                  |
| get_push_certificate             | Ensure a valid push profile is   | KrauseFx         |
|                                  | active, creating a new one if    |                  |
|                                  | needed (via _pem_)               |                  |
| get_version_number               | Get the version number of your   | Multiple         |
|                                  | project                          |                  |
| git_add                          | Directly add the given file or   | Multiple         |
|                                  | all files                        |                  |
| git_branch                       | Returns the name of the current  | KrauseFx         |
|                                  | git branch, possibly as managed  |                  |
|                                  | by CI ENV vars                   |                  |
| git_commit                       | Directly commit the given file   | KrauseFx         |
|                                  | with the given message           |                  |
| git_pull                         | Executes a simple git pull       | Multiple         |
|                                  | command                          |                  |
| git_remote_branch                | Returns the name of the current  | SeanMcNeil       |
|                                  | git remote default branch        |                  |
| git_submodule_update             | Executes a git submodule update  | braunico         |
|                                  | command                          |                  |
| git_tag_exists                   | Checks if the git tag with the   | antondomashnev   |
|                                  | given name exists in the         |                  |
|                                  | current repo                     |                  |
| github_api                       | Call a GitHub API endpoint and   | tommeier         |
|                                  | get the resulting JSON response  |                  |
| google_play_track_release_names  | Retrieves release names for a    | raldred          |
|                                  | Google Play track                |                  |
| google_play_track_version_codes  | Retrieves version codes for a    | panthomakos      |
|                                  | Google Play track                |                  |
| gradle                           | All gradle related actions,      | Multiple         |
|                                  | including building and testing   |                  |
|                                  | your Android app                 |                  |
| gym                              | Alias for the `build_app`        | KrauseFx         |
|                                  | action                           |                  |
| hg_add_tag                       | This will add a hg tag to the    | sjrmanning       |
|                                  | current branch                   |                  |
| hg_commit_version_bump           | This will commit a version bump  | sjrmanning       |
|                                  | to the hg repo                   |                  |
| hg_ensure_clean_status           | Raises an exception if there     | sjrmanning       |
|                                  | are uncommitted hg changes       |                  |
| hg_push                          | This will push changes to the    | sjrmanning       |
|                                  | remote hg repository             |                  |
| hipchat                          | Send a error/success message to  | jingx23          |
|                                  | "HipChat"                        |                  |
|                                  | (https://www.hipchat.com/ ğŸ”—)    |                  |
| hockey (DEPRECATED)              | Refer to "App Center"            | Multiple         |
|                                  | (https://github.com/Microsoft/f  |                  |
|                                  | astlane-plugin-appcenter/ ğŸ”—)    |                  |
| ifttt                            | Connect to the "IFTTT Maker      | vpolouchkine     |
|                                  | Channel"                         |                  |
|                                  | (https://ifttt.com/maker ğŸ”—)     |                  |
| import                           | Import another Fastfile to use   | KrauseFx         |
|                                  | its lanes                        |                  |
| import_certificate               | Import certificate from          | gin0606          |
|                                  | inputfile into a keychain        |                  |
| import_from_git                  | Import another Fastfile from a   | Multiple         |
|                                  | remote git repository to use     |                  |
|                                  | its lanes                        |                  |
| increment_build_number           | Increment the build number of    | KrauseFx         |
|                                  | your project                     |                  |
| increment_version_number         | Increment the version number of  | serluca          |
|                                  | your project                     |                  |
| install_on_device                | Installs an .ipa file on a       | hjanuschka       |
|                                  | connected iOS-device via usb or  |                  |
|                                  | wifi                             |                  |
| install_provisioning_profile     | Install provisioning profile     | SofteqDG         |
|                                  | from path                        |                  |
| install_xcode_plugin             | Install an Xcode plugin for the  | Multiple         |
|                                  | current user                     |                  |
| installr                         | Upload a new build to            | scottrhoyt       |
|                                  | "Installr"                       |                  |
|                                  | (http://installrapp.com/ ğŸ”—)     |                  |
| ipa (DEPRECATED)                 | Easily build and sign your app   | joshdholtz       |
|                                  | using shenzhen                   |                  |
| is_ci                            | Is the current run being         | KrauseFx         |
|                                  | executed on a CI system, like    |                  |
|                                  | Jenkins or Travis                |                  |
| jazzy                            | Generate docs using Jazzy        | KrauseFx         |
| jira                             | Leave a comment on a Jira        | Multiple         |
|                                  | ticket                           |                  |
| lane_context                     | Access lane context values       | KrauseFx         |
| last_git_commit                  | Return last git commit hash,     | ngutman          |
|                                  | abbreviated commit hash, commit  |                  |
|                                  | message and author               |                  |
| last_git_tag                     | Get the most recent git tag      | Multiple         |
| latest_testflight_build_number   | Fetches most recent build        | daveanderson     |
|                                  | number from TestFlight           |                  |
| lcov                             | Generates coverage data using    | thiagolioy       |
|                                  | lcov                             |                  |
| mailgun                          | Send a success/error message to  | thiagolioy       |
|                                  | an email group                   |                  |
| make_changelog_from_jenkins      | Generate a changelog using the   | mandrizzle       |
|                                  | Changes section from the         |                  |
|                                  | current Jenkins build            |                  |
| match                            | Alias for the                    | KrauseFx         |
|                                  | `sync_code_signing` action       |                  |
| match_nuke                       | Easily nuke your certificate     | crazymanish      |
|                                  | and provisioning profiles (via   |                  |
|                                  | _match_)                         |                  |
| min_fastlane_version             | Verifies the minimum fastlane    | KrauseFx         |
|                                  | version required                 |                  |
| modify_services                  | Modifies the services of the     | bhimsenpadalkar  |
|                                  | app created on Developer Portal  |                  |
| nexus_upload                     | Upload a file to "Sonatype       | Multiple         |
|                                  | Nexus platform"                  |                  |
|                                  | (https://www.sonatype.com ğŸ”—)    |                  |
| notarize                         | Notarizes a macOS app            | zeplin           |
| notification                     | Display a macOS notification     | Multiple         |
|                                  | with custom message and title    |                  |
| notify (DEPRECATED)              | Shows a macOS notification -     | Multiple         |
|                                  | use `notification` instead       |                  |
| number_of_commits                | Return the number of commits in  | Multiple         |
|                                  | current git branch               |                  |
| oclint                           | Lints implementation files with  | HeEAaD           |
|                                  | OCLint                           |                  |
| onesignal                        | Create or update a new           | Multiple         |
|                                  | "OneSignal"                      |                  |
|                                  | (https://onesignal.com/ ğŸ”—)      |                  |
|                                  | application                      |                  |
| opt_out_crash_reporting          | This will prevent reports from   | Multiple         |
| (DEPRECATED)                     | being uploaded when _fastlane_   |                  |
|                                  | crashes                          |                  |
| opt_out_usage                    | This will stop uploading the     | KrauseFx         |
|                                  | information which actions were   |                  |
|                                  | run                              |                  |
| pem                              | Alias for the                    | KrauseFx         |
|                                  | `get_push_certificate` action    |                  |
| pilot                            | Alias for the                    | KrauseFx         |
|                                  | `upload_to_testflight` action    |                  |
| pod_lib_lint                     | Pod lib lint                     | thierryxing      |
| pod_push                         | Push a Podspec to Trunk or a     | squarefrog       |
|                                  | private repository               |                  |
| podio_item                       | Creates or updates an item       | Multiple         |
|                                  | within your Podio app            |                  |
| precheck                         | Alias for the                    | taquitos         |
|                                  | `check_app_store_metadata`       |                  |
|                                  | action                           |                  |
| println                          | Alias for the `puts` action      | KrauseFx         |
| produce                          | Alias for the                    | KrauseFx         |
|                                  | `create_app_online` action       |                  |
| prompt                           | Ask the user for a value or for  | KrauseFx         |
|                                  | confirmation                     |                  |
| push_git_tags                    | Push local tags to the remote -  | vittoriom        |
|                                  | this will only push tags         |                  |
| push_to_git_remote               | Push local changes to the        | lmirosevic       |
|                                  | remote branch                    |                  |
| puts                             | Prints out the given text        | KrauseFx         |
| read_podspec                     | Loads a CocoaPods spec as JSON   | czechboy0        |
| recreate_schemes                 | Recreate not shared Xcode        | jerolimov        |
|                                  | project schemes                  |                  |
| register_device                  | Registers a new device to the    | pvinis           |
|                                  | Apple Dev Portal                 |                  |
| register_devices                 | Registers new devices to the     | lmirosevic       |
|                                  | Apple Dev Portal                 |                  |
| reset_git_repo                   | Resets git repo to a clean       | lmirosevic       |
|                                  | state by discarding uncommitted  |                  |
|                                  | changes                          |                  |
| reset_simulator_contents         | Shutdown and reset running       | danramteke       |
|                                  | simulators                       |                  |
| resign                           | Codesign an existing ipa file    | lmirosevic       |
| restore_file                     | This action restore your file    | gin0606          |
|                                  | that was backuped with the       |                  |
|                                  | `backup_file` action             |                  |
| rocket                           | Outputs ascii-art for a rocket   | Multiple         |
|                                  | ğŸš€                               |                  |
| rsync                            | Rsync files from :source to      | hjanuschka       |
|                                  | :destination                     |                  |
| ruby_version                     | Verifies the minimum ruby        | sebastianvarela  |
|                                  | version required                 |                  |
| run_tests                        | Easily run tests of your iOS     | KrauseFx         |
|                                  | app (via _scan_)                 |                  |
| s3 (DEPRECATED)                  | Generates a plist file and       | joshdholtz       |
|                                  | uploads all to AWS S3            |                  |
| say                              | This action speaks the given     | KrauseFx         |
|                                  | text out loud                    |                  |
| scan                             | Alias for the `run_tests`        | KrauseFx         |
|                                  | action                           |                  |
| scp                              | Transfer files via SCP           | hjanuschka       |
| screengrab                       | Alias for the                    | Multiple         |
|                                  | `capture_android_screenshots`    |                  |
|                                  | action                           |                  |
| set_build_number_repository      | Set the build number from the    | Multiple         |
|                                  | current repository               |                  |
| set_changelog                    | Set the changelog for all        | KrauseFx         |
|                                  | languages on App Store Connect   |                  |
| set_github_release               | This will create a new release   | Multiple         |
|                                  | on GitHub and upload assets for  |                  |
|                                  | it                               |                  |
| set_info_plist_value             | Sets value to Info.plist of      | Multiple         |
|                                  | your project as native Ruby      |                  |
|                                  | data structures                  |                  |
| set_pod_key                      | Sets a value for a key with      | marcelofabri     |
|                                  | cocoapods-keys                   |                  |
| setup_ci                         | Setup the keychain and match to  | Multiple         |
|                                  | work with CI                     |                  |
| setup_circle_ci                  | Setup the keychain and match to  | dantoml          |
|                                  | work with CircleCI               |                  |
| setup_jenkins                    | Setup xcodebuild, gym and scan   | bartoszj         |
|                                  | for easier Jenkins integration   |                  |
| setup_travis                     | Setup the keychain and match to  | KrauseFx         |
|                                  | work with Travis CI              |                  |
| sh                               | Runs a shell command             | KrauseFx         |
| sigh                             | Alias for the                    | KrauseFx         |
|                                  | `get_provisioning_profile`       |                  |
|                                  | action                           |                  |
| skip_docs                        | Skip the creation of the         | KrauseFx         |
|                                  | fastlane/README.md file when     |                  |
|                                  | running fastlane                 |                  |
| slack                            | Send a success/error message to  | KrauseFx         |
|                                  | your "Slack" (https://slack.com  |                  |
|                                  | ğŸ”—) group                        |                  |
| slather                          | Use slather to generate a code   | mattdelves       |
|                                  | coverage report                  |                  |
| snapshot                         | Alias for the                    | KrauseFx         |
|                                  | `capture_ios_screenshots`        |                  |
|                                  | action                           |                  |
| sonar                            | Invokes sonar-scanner to         | c_gretzki        |
|                                  | programmatically run SonarQube   |                  |
|                                  | analysis                         |                  |
| sourcedocs                       | Generate docs using SourceDocs   | Kukurijek        |
| spaceship_logs                   | Find, print, and copy Spaceship  | joshdholtz       |
|                                  | logs                             |                  |
| spaceship_stats                  | Print out Spaceship stats from   | joshdholtz       |
|                                  | this session (number of request  |                  |
|                                  | to each domain)                  |                  |
| splunkmint                       | Upload dSYM file to "Splunk      | xfreebird        |
|                                  | MINT" (https://mint.splunk.com/  |                  |
|                                  | ğŸ”—)                              |                  |
| spm                              | Runs Swift Package Manager on    | Multiple         |
|                                  | your project                     |                  |
| ssh                              | Allows remote command execution  | hjanuschka       |
|                                  | using ssh                        |                  |
| supply                           | Alias for the                    | KrauseFx         |
|                                  | `upload_to_play_store` action    |                  |
| swiftlint                        | Run swift code validation using  | KrauseFx         |
|                                  | SwiftLint                        |                  |
| sync_code_signing                | Easily sync your certificates    | KrauseFx         |
|                                  | and profiles across your team    |                  |
|                                  | (via _match_)                    |                  |
| team_id                          | Specify the Team ID you want to  | KrauseFx         |
|                                  | use for the Apple Developer      |                  |
|                                  | Portal                           |                  |
| team_name                        | Set a team to use by its name    | KrauseFx         |
| testfairy                        | Upload a new build to            | Multiple         |
|                                  | "TestFairy"                      |                  |
|                                  | (https://www.testfairy.com/ ğŸ”—)  |                  |
| testflight                       | Alias for the                    | KrauseFx         |
|                                  | `upload_to_testflight` action    |                  |
| trainer                          | Convert the Xcode plist log to   | KrauseFx         |
|                                  | a JUnit report                   |                  |
| tryouts                          | Upload a new build to "Tryouts"  | alicertel        |
|                                  | (https://tryouts.io/ ğŸ”—)         |                  |
| twitter                          | Post a tweet on "Twitter.com"    | hjanuschka       |
|                                  | (https://twitter.com ğŸ”—)         |                  |
| typetalk                         | Post a message to "Typetalk"     | Nulab Inc.       |
|                                  | (https://www.typetalk.com/ ğŸ”—)   |                  |
| unlock_keychain                  | Unlock a keychain                | xfreebird        |
| update_app_group_identifiers     | This action changes the app      | mathiasAichinger |
|                                  | group identifiers in the         |                  |
|                                  | entitlements file                |                  |
| update_app_identifier            | Update the project's bundle      | Multiple         |
|                                  | identifier                       |                  |
| update_code_signing_settings     | Configures Xcode's Codesigning   | Multiple         |
|                                  | options                          |                  |
| update_fastlane                  | Makes sure fastlane-tools are    | Multiple         |
|                                  | up-to-date when running          |                  |
|                                  | fastlane                         |                  |
| update_icloud_container_identif  | This action changes the iCloud   | JamesKuang       |
| iers                             | container identifiers in the     |                  |
|                                  | entitlements file                |                  |
| update_info_plist                | Update a Info.plist file with    | tobiasstrebitzer |
|                                  | bundle identifier and display    |                  |
|                                  | name                             |                  |
| update_keychain_access_groups    | This action changes the          | yutae            |
|                                  | keychain access groups in the    |                  |
|                                  | entitlements file                |                  |
| update_plist                     | Update a plist file              | Multiple         |
| update_project_code_signing      | Updated code signing settings    | KrauseFx         |
| (DEPRECATED)                     | from 'Automatic' to a specific   |                  |
|                                  | profile                          |                  |
| update_project_provisioning      | Update projects code signing     | Multiple         |
|                                  | settings from your provisioning  |                  |
|                                  | profile                          |                  |
| update_project_team              | Update Xcode Development Team    | lgaches          |
|                                  | ID                               |                  |
| update_urban_airship_configurat  | Set "Urban Airship"              | kcharwood        |
| ion                              | (https://www.urbanairship.com/   |                  |
|                                  | ğŸ”—) plist configuration values   |                  |
| update_url_schemes               | Updates the URL schemes in the   | kmikael          |
|                                  | given Info.plist                 |                  |
| upload_app_privacy_details_to_a  | Upload App Privacy Details for   | joshdholtz       |
| pp_store                         | an app in App Store Connect      |                  |
| upload_symbols_to_crashlytics    | Upload dSYM symbolication files  | KrauseFx         |
|                                  | to Crashlytics                   |                  |
| upload_symbols_to_sentry         | Upload dSYM symbolication files  | joshdholtz       |
| (DEPRECATED)                     | to Sentry                        |                  |
| upload_to_app_store              | Upload metadata and binary to    | KrauseFx         |
|                                  | App Store Connect (via           |                  |
|                                  | _deliver_)                       |                  |
| upload_to_play_store             | Upload metadata, screenshots     | KrauseFx         |
|                                  | and binaries to Google Play      |                  |
|                                  | (via _supply_)                   |                  |
| upload_to_play_store_internal_a  | Upload binaries to Google Play   | andrewhavens     |
| pp_sharing                       | Internal App Sharing (via        |                  |
|                                  | _supply_)                        |                  |
| upload_to_testflight             | Upload new binary to App Store   | KrauseFx         |
|                                  | Connect for TestFlight beta      |                  |
|                                  | testing (via _pilot_)            |                  |
| validate_play_store_json_key     | Validate that the Google Play    | janpio           |
|                                  | Store `json_key` works           |                  |
| verify_build                     | Able to verify various settings  | CodeReaper       |
|                                  | in ipa file                      |                  |
| verify_pod_keys                  | Verifies all keys referenced     | ashfurrow        |
|                                  | from the Podfile are non-empty   |                  |
| verify_xcode                     | Verifies that the Xcode          | KrauseFx         |
|                                  | installation is properly signed  |                  |
|                                  | by Apple                         |                  |
| version_bump_podspec             | Increment or set the version in  | Multiple         |
|                                  | a podspec file                   |                  |
| version_get_podspec              | Receive the version number from  | Multiple         |
|                                  | a podspec file                   |                  |
| xcarchive                        | Archives the project using       | dtrenz           |
|                                  | `xcodebuild`                     |                  |
| xcbuild                          | Builds the project using         | dtrenz           |
|                                  | `xcodebuild`                     |                  |
| xcclean                          | Cleans the project using         | dtrenz           |
|                                  | `xcodebuild`                     |                  |
| xcexport                         | Exports the project using        | dtrenz           |
|                                  | `xcodebuild`                     |                  |
| xcode_install                    | Make sure a certain version of   | Krausefx         |
|                                  | Xcode is installed               |                  |
| xcode_select                     | Change the xcode-path to use.    | dtrenz           |
|                                  | Useful for beta versions of      |                  |
|                                  | Xcode                            |                  |
| xcode_server_get_assets          | Downloads Xcode Bot assets like  | czechboy0        |
|                                  | the `.xcarchive` and logs        |                  |
| xcodebuild                       | Use the `xcodebuild` command to  | dtrenz           |
|                                  | build and sign your app          |                  |
| xcov                             | Nice code coverage reports       | nakiostudio      |
|                                  | without hassle                   |                  |
| xctest                           | Runs tests on the given          | dtrenz           |
|                                  | simulator                        |                  |
| xctool                           | Run tests using xctool           | KrauseFx         |
| xcversion                        | Select an Xcode to use by        | Multiple         |
|                                  | version specifier                |                  |
| zip                              | Compress a file or folder to a   | KrauseFx         |
|                                  | zip                              |                  |
+----------------------------------+----------------------------------+------------------+
```

### Fastlane å‘å¸ƒ TestFlight

- [å‚è€ƒèµ„æ–™ï¼šç®€ä¹¦ - iOS(Swift) fastlaneé›†æˆ,å‘é€ testflight(äºŒ)](https://www.jianshu.com/p/e60b1d3e7c69)
- [å‚è€ƒèµ„æ–™ï¼šæ˜é‡‘ - iOS+Fastlaneè‡ªåŠ¨æ‰“åŒ…å‘å¸ƒåˆ°TestFlight](https://juejin.cn/post/7021167923632799758)

`fastlane` è‡ªåŠ¨åŒ–æ‰“åŒ…å‘å¸ƒåˆ° `TestFlight` éœ€è¦å€ŸåŠ©åˆ° `AppStore Connect` ä¸­çš„ **`å¯†é’¥`** ï¼Œæ‰€ä»¥éœ€è¦æå‰å…ˆç”³è¯·ä¸€ä¸‹ï¼š
- ç™»å½• [AppStore Connect](https://appstoreconnect.apple.com)ï¼›
- ç‚¹å‡» `Users and Accessï¼ˆç”¨æˆ·å’Œè®¿é—®ï¼‰` -> `Keysï¼ˆå¯†é’¥ï¼‰` -> `App Store Connect API`ï¼›
- ç‚¹å‡» `è¯·æ±‚è®¿é—®æƒé™`ï¼Œç„¶åæ‰§è¡Œæ“ä½œæ­¥éª¤ç”³è¯· `Key`ï¼›
- `ç”Ÿäº§ API å¯†é’¥` æ—¶éœ€è¦æ³¨æ„ï¼Œç”Ÿæˆçš„å¯†é’¥ç»“æœæ–‡ä»¶ï¼Œ**`åªèƒ½ä¸‹è½½ä¸€æ¬¡`** ï¼Œæ‰€ä»¥éœ€è¦æ³¨æ„ä¿å­˜æ–‡ä»¶ã€‚
- éœ€è¦ç”¨åˆ° `Issuer ID`ã€`Key ID`ï¼Œä»¥åŠå¯¹åº”çš„ `å¯†é’¥æ–‡ä»¶ï¼ˆ.p8 æ–‡ä»¶ï¼‰`ã€‚

![Fastlane - ç”³è¯·å¯†é’¥ 01](/images/iOS/2022-05-07-Fastlane-05.png)
![Fastlane - ç”³è¯·å¯†é’¥ 02](/images/iOS/2022-05-07-Fastlane-06.png)

```swift
/// Fastfile
# update_fastlane
default_platform(:ios)
platform :ios do 
  desc "Push a new ad-hoc build to TestFlightã€pgyerã€fir.im."
  lane :export_ipa do |option|
    puts "ã€å…¬å‘Šã€‘æ‰“åŒ…å¼€å§‹ -------------------------"
    gym(
      clean: true,
      output_directory: "./fastlane/package",
      scheme: "JJCComicBook",
      workspace: "JJCComicBook.xcworkspace",
      configuration: "Release",
      export_method: "app-store",
      export_options: {iCloudContainerEnvironment: "Production"},
      export_xcargs: "-allowProvisioningUpdates"
    )
    puts "ã€å…¬å‘Šã€‘æ‰“åŒ…ç»“æŸ -------------------------"

    # macä¸Šçš„é€šçŸ¥å¼¹çª—ï¼Œé€šçŸ¥æ‰“åŒ…å®Œæ¯•
    notification(app_icon: "./fastlane/icon.png", title: "è‹œè“¿æ¼«ç”»", subtitle: "æ‰“åŒ…æˆåŠŸï¼Œå·²å¯¼å‡ºå®‰è£…åŒ…", message: "å‡†å¤‡å‘å¸ƒä¸­â€¦â€¦")

    puts "ã€å…¬å‘Šã€‘ä¸Šä¼  TestFlight å¼€å§‹ -------------------------"
    api_key = app_store_connect_api_key(
      key_id: "7******S", 
      issuer_id: "53*********************68",
      key_filepath: "./fastlane/JJCComicBook_API_Key_Developer.p8",
      duration: 1200,
      in_house: false
    )
    upload_to_testflight(
      api_key: api_key,
      skip_waiting_for_build_processing: true,
      # username: "å¼€å‘è€…è´¦æˆ·é‚®ç®±",
      # app_identifier: "Bundle ID",
      ipa: "./fastlane/package/JJCComicBook.ipa",
      skip_submission:true
    )
    puts "ã€å…¬å‘Šã€‘ä¸Šä¼  TestFlight ç»“æŸ -------------------------"
  end
end
```

å¦å¤–åœ¨é…ç½®ä¸­ `key_id` å’Œ `usernameã€app_identifier` ä¸åŒåŒæ—¶å…±å­˜ï¼Œåªä¿ç•™å…¶ä¸­ä¸€æ–¹å°±è¡Œäº†ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼š

```swift
[!] Unresolved conflict between options: 'api_key' and 'username'
```

å†è€…ï¼Œä¸Šä¼ åˆ° `TestFlight` å¸¸å¸¸ä¼šé‡åˆ° `ç¼ºå°‘å‡ºå£åˆè§„è¯æ˜` çš„é…ç½®é€‰é¡¹ï¼Œæ¯æ¬¡å‘å¸ƒç‰ˆæœ¬éƒ½éœ€è¦æ‰‹åŠ¨é€‰æ‹©ä¸€æ¬¡ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œè§£å†³åŠæ³•ï¼š

```swift
/// åªéœ€è¦åœ¨é¡¹ç›®å·¥ç¨‹çš„ info.plist æ–‡ä»¶ä¸­ï¼Œæ·»åŠ  App Uses Non-Exempt Encryption è®¾ç½®ä¸º NO å³å¯
<key>ITSAppUsesNonExemptEncryption</key>
    <false/>
```

![Fastlane - ä¸Šä¼  TestFlight æˆåŠŸ 01](/images/iOS/2022-05-07-Fastlane-07.png)

### Fastlane å‘å¸ƒè’²å…¬è‹±
#### Fastlane + è’²å…¬è‹±

- [Fastlane - å®˜ç½‘](https://docs.fastlane.tools/)
- [Fastlane - plugins](https://docs.fastlane.tools/plugins/using-plugins/)
- [è’²å…¬è‹±å®˜ç½‘](https://www.pgyer.com/)

```swift
/// æŸ¥è¯¢ plugins æŒ‡ä»¤
fastlane search_plugins xxx
/// æ·»åŠ å®‰è£… plugin æŒ‡ä»¤ï¼Œå»ºè®®å‰é¢åŠ  sudoï¼Œå¦åˆ™å¶å°”ä¼šå› ä¸ºæƒé™é—®é¢˜æŠ¥é”™
fastlane add_plugin xxx
/// å®‰è£… pluginsï¼Œå‰ææ˜¯åˆ›å»ºçš„æœ‰ Pluginfile çš„ Gemfile æ–‡ä»¶ï¼Œé‡Œé¢æ·»åŠ çš„æœ‰å¯¹åº”çš„ plugin
fastlane install_plugins
/// æ›´æ–° plugins
fastlane update_plugins
```

`Fastlane` éœ€è¦é€šè¿‡ `pgyer` æŒ‡ä»¤æ‰èƒ½å¤„ç†ä¸Šä¼  `è’²å…¬è‹±` ç›¸å…³çš„ä»»åŠ¡ï¼Œè€Œ `Fastlane` å®˜æ–¹å®é™…ä¸Šå¹¶æ²¡æœ‰æä¾›è¯¥æŒ‡ä»¤ï¼Œè¿™æ˜¯é€šè¿‡ `plugins` æ‰©å±•æ’ä»¶å®ç°çš„ï¼Œæ˜¯ `è’²å…¬è‹±` å®˜æ–¹æä¾›çš„ `CI`ã€‚

```swift
/// é€šè¿‡è¯¥æŒ‡ä»¤æ·»åŠ å¯¹ pgyer çš„æ”¯æŒ
sudo fastlane add_plugin pgyer
```

æ‰§è¡Œå®Œè¯¥æŒ‡ä»¤åï¼Œåœ¨ `./fastlane` æ–‡ä»¶å¤¹ä¸‹ä¼šå¤šå‡ºä¸€ä¸ª `Pluginfile` çš„ `Gemfile` æ–‡ä»¶ï¼Œç”¨äºç®¡ç† `plugins` æ‰©å±•çš„ã€‚

```swift
/// Fastfile
# update_fastlane
default_platform(:ios)
platform :ios do 
  desc "Push a new ad-hoc build to TestFlightã€pgyerã€fir.im."
  lane :export_ipa do |option|
    puts "ã€å…¬å‘Šã€‘æ‰“åŒ…å¼€å§‹ -------------------------"
    gym(
      clean: true,
      output_directory: "./fastlane/package",
      scheme: "JJCComicBook",
      workspace: "JJCComicBook.xcworkspace",
      configuration: "Release",
      export_method: "app-store",
      export_options: {iCloudContainerEnvironment: "Production"},
      export_xcargs: "-allowProvisioningUpdates"
    )
    puts "ã€å…¬å‘Šã€‘æ‰“åŒ…ç»“æŸ -------------------------"

    # macä¸Šçš„é€šçŸ¥å¼¹çª—ï¼Œé€šçŸ¥æ‰“åŒ…å®Œæ¯•
    notification(app_icon: "./fastlane/icon.png", title: "è‹œè“¿æ¼«ç”»", subtitle: "æ‰“åŒ…æˆåŠŸï¼Œå·²å¯¼å‡ºå®‰è£…åŒ…", message: "å‡†å¤‡å‘å¸ƒä¸­â€¦â€¦")

    updateVersionDes = "è‹œè“¿è‹œè“¿_v2.0.4(2)\n1ã€ä¿®å¤éƒ¨åˆ†æ¼«æºå¤±æ•ˆé—®é¢˜ï¼›\n2ã€ä¼˜åŒ–ç»†èŠ‚é—®é¢˜ã€‚"

    puts "ã€å…¬å‘Šã€‘ä¸Šä¼ è’²å…¬è‹±åˆ†å‘å¹³å°å¼€å§‹ -------------------------"
    # ä¸Šä¼ åˆ°è’²å…¬è‹±å‘å¸ƒå¹³å°
    pgyer(
      api_key: "ef**********************f8",
      user_key: "80**********************c5",
      update_description: updateVersionDes
    )
    puts "ã€å…¬å‘Šã€‘ä¸Šä¼ è’²å…¬è‹±åˆ†å‘å¹³å°ç»“æŸ -------------------------"
  end
end

```

#### Fastlane + è’²å…¬è‹± + é’‰é’‰æœºå™¨äºº + Webhook URL

- [è’²å…¬è‹±å®˜ç½‘](https://www.pgyer.com/)
- [å‚è€ƒé“¾æ¥ï¼šæ˜é‡‘ - iOS+Fastlaneè‡ªåŠ¨æ‰“åŒ…å‘å¸ƒæµ‹è¯•ã€æ¶ˆæ¯é€šçŸ¥ï¼Œå®Œç¾ç»“åˆï¼](https://juejin.cn/post/7008553785672859656)

éœ€è¦é€šè¿‡ `Webhook URL` è¿›è¡Œå…³è”è‡ªåŠ¨å‘å¸ƒï¼Œè’²å…¬è‹±å®˜æ–¹ç°åœ¨æ”¯æŒå››ç§æ–¹å¼çš„ `Webhook URL`ï¼Œåˆ†åˆ«æ˜¯ `ä¼ä¸šå¾®ä¿¡ã€é£ä¹¦ã€é’‰é’‰ã€å…¶ä»–` å››ç§æƒ…å†µã€‚

é¦–å…ˆéœ€è¦åœ¨é’‰é’‰ï¼ˆversion_v5.1.39ï¼‰ç¾¤ç»„çš„ `ç¾¤è®¾ç½® -> æ™ºèƒ½ç¾¤åŠ©æ‰‹ -> æ·»åŠ æœºå™¨äºº -> è‡ªå®šä¹‰ï¼ˆé€šè¿‡ Webhook æ¥å…¥è‡ªå®šä¹‰æœåŠ¡ï¼‰` æ·»åŠ ä¸€ä¸ªç¾¤ç»„æœºå™¨äººï¼Œåœ¨ `è‡ªå®šä¹‰å…³é”®è¯` ä¸­æ·»åŠ ä¸€ä¸ªå…³é”®è¯ï¼Œä¿è¯å¯ä»¥åœ¨æ¯æ¬¡å‘å¸ƒåœ¨è’²å…¬è‹±çš„åº”ç”¨ç‰ˆæœ¬ `æ›´æ–°å†…å®¹` ä¸­éƒ½ä¼šåŒ…å«çš„å…³é”®è¯å³å¯ã€‚

å…¶æ¬¡åœ¨è’²å…¬è‹±å®˜ç½‘é€šè¿‡ `æ§åˆ¶å° -> æŸä¸ªåº”ç”¨ -> è®¾ç½® -> Webhook è®¾ç½®`ï¼Œå°†é€šè¿‡é’‰é’‰è·å–åˆ°çš„æœºå™¨äººçš„ `Webhook URL` é“¾æ¥æ·»åŠ åˆ°è¯¥è®¾ç½®ä¸­å¯¹åº”çš„ `URL` ä¸€æ å³å¯ã€‚

æ­¤åæ¯æ¬¡å‘å¸ƒæ–°ç‰ˆæœ¬æ—¶ï¼Œåªéœ€è¦åœ¨ `æ›´æ–°å†…å®¹` ä¸­åŒ…å«æœ‰å¯¹åº” `å…³é”®å­—` å³å¯å®ç°è‡ªåŠ¨æ¶ˆæ¯æ¨é€ï¼Œå…å»äº†æ¯æ¬¡éœ€è¦æ‰‹åŠ¨æ·»åŠ æ¶ˆæ¯å‘å¸ƒåˆ°å¯¹åº”çš„é’‰é’‰ç¾¤ä¸­ã€‚

### Fastlane å‘å¸ƒ Fir.im 
#### Fastlane + Firï¼ˆå®˜æ–¹ç‰ˆï¼‰

- [Fir.im - å®˜ç½‘](https://www.betaqr.com/)
- [Fir.im - å…³äº fir.im fastlane æ’ä»¶çš„ä¸€äº›è¯´æ˜](https://blog.betaqr.com/guan-yu-fastlane-cha-jian-wen-ti/)
- [Firim æ’ä»¶ï¼ˆéå®˜æ–¹ï¼‰](https://github.com/whlsxl/firim)
- [Firim æ’ä»¶ï¼ˆéå®˜æ–¹ï¼‰- fastlane](https://github.com/whlsxl/firim/tree/master/fastlane-plugin-firim)
- [å‚è€ƒèµ„æ–™ï¼šPermission denied @ rb_sysopen - /Library/Ruby/Gems/2.3.0/cache/rack-2.0.4.gem](https://www.jianshu.com/p/64cfc0d78fe8)

`Fir.im` åŒ `è’²å…¬è‹±` ä¸€æ ·ï¼Œéƒ½æ˜¯å¸¸è§çš„ App åˆ†å‘å¹³å°ã€‚

åŒ `è’²å…¬è‹±` ä¸€æ ·ï¼Œéƒ½éœ€è¦é¢å¤–å¢åŠ  `plugin` æ‰å¯ä»¥ï¼š

```swift
/// æ‰§è¡Œå®‰è£… fir æ’ä»¶
fastlane add_plugin fir_cli
/// å¦‚æœä¸Šé¢å‡ºç°æŠ¥é”™ï¼Œåˆ™ä½¿ç”¨ä¸‹é¢æŒ‡ä»¤
sudo fastlane add_plugin fir_cli
/// å¦‚æœä¸Šé¢å‡ºç°æŠ¥é”™ï¼Œåˆ™ä½¿ç”¨ä¸‹é¢æŒ‡ä»¤
sudo fastlane add_plugin -n /usr/local/bin/ fir_cli
```

ç´§æ¥ç€è¿˜éœ€è¦é€šè¿‡ `gem` å®‰è£…è‡ªåŠ¨ä¸Šä¼ åˆ° `fir` ç›¸å…³çš„ `CI`ï¼š

```swift
/// å®‰è£… fir è‡ªåŠ¨ä¸Šä¼ çš„ CI
gem install fir-cli
/// å¦‚æœä¸Šé¢æŒ‡ä»¤æŠ¥é”™ï¼Œåˆ™ä½¿ç”¨ä¸‹é¢æŒ‡ä»¤
sudo gem install fir-cli
/// å¦‚æœä¸Šé¢æŒ‡ä»¤æŠ¥é”™ï¼Œåˆ™ä½¿ç”¨ä¸‹é¢æŒ‡ä»¤
sudo gem install -n /usr/local/bin fir-cli
```

å¦å¤–ï¼Œåœ¨ä½¿ç”¨ `fir.im` çš„æ—¶å€™ï¼Œé…ç½®çš„å‚æ•°æ˜¯ `firim_api_token`ï¼Œå¹¶éæ˜¯ `åº”ç”¨ ID`ï¼Œ`firim_api_token` é€šè¿‡ç‚¹å‡» `ä¸ªäººè´¦æˆ· -> API Tokenï¼ˆåœ¨ä¸ªäººèµ„æ–™ã€å‘ç¥¨ä¿¡æ¯ä¸‹é¢ï¼‰`ã€‚

å¯¹åº”çš„ `Fastfile` æ–‡ä»¶é…ç½®ï¼š

```swift
/// Fastfile
# update_fastlane
default_platform(:ios)
platform :ios do 
  desc "Push a new ad-hoc build to TestFlightã€pgyerã€fir.im."
  lane :export_ipa do |option|
    puts "ã€å…¬å‘Šã€‘æ‰“åŒ…å¼€å§‹ -------------------------"
    gym(
      clean: true,
      output_directory: "./fastlane/package",
      scheme: "JJCComicBook",
      workspace: "JJCComicBook.xcworkspace",
      configuration: "Release",
      export_method: "app-store",
      export_options: {iCloudContainerEnvironment: "Production"},
      export_xcargs: "-allowProvisioningUpdates"
    )
    puts "ã€å…¬å‘Šã€‘æ‰“åŒ…ç»“æŸ -------------------------"

    # macä¸Šçš„é€šçŸ¥å¼¹çª—ï¼Œé€šçŸ¥æ‰“åŒ…å®Œæ¯•
    notification(app_icon: "./fastlane/icon.png", title: "è‹œè“¿æ¼«ç”»", subtitle: "æ‰“åŒ…æˆåŠŸï¼Œå·²å¯¼å‡ºå®‰è£…åŒ…", message: "å‡†å¤‡å‘å¸ƒä¸­â€¦â€¦")

    puts "ã€å…¬å‘Šã€‘ä¸Šä¼  fir.im åˆ†å‘å¹³å°å¼€å§‹ -------------------------"
    # ä¸Šä¼ åˆ° fir.im å‘å¸ƒå¹³å°
    fir_cli(
      api_token: "df****************61", 
      changelog: "æµ‹è¯• changelog"
    )
    puts "ã€å…¬å‘Šã€‘ä¸Šä¼  fir.im åˆ†å‘å¹³å°ç»“æŸ -------------------------"
  end
end

```

**Webhook é…ç½®ï¼š**

åœ¨ `åº”ç”¨ -> é›†æˆ -> æ¶ˆæ¯æ¨é€ -> Custom` é…ç½®ã€‚

```swift
/// fir_cli å¯ç”¨å‚æ•°ï¼š
+-----------------+-----------------+-----------------+---------+
|                        fir_cli Options                        |
+-----------------+-----------------+-----------------+---------+
| Key             | Description     | Env Var(s)      | Default |
+-----------------+-----------------+-----------------+---------+
| api_token       | A description   | FIR_CLI_API_TO  |         |
|                 | of your option  | KEN             |         |
| specify_file_p  | FILE APP PATH   | FIR_SPECIFY_FI  |         |
| ath             |                 | LE_PATH         |         |
| short           | fir short       | FIR_APP_SHORT   |         |
| force_pin_hist  | pin this        | FIR_APP_FORCE_  | false   |
| ory             | release to      | PIN_HISTORY     |         |
|                 | download page   |                 |         |
| skip_update_ic  | skip upload     | FIR_APP_SKIP_U  | false   |
| on              | icon            | PDATE_ICON      |         |
| specify_icon_f  | APP ICON FILE   | FIR_SPECIFY_IC  |         |
| ile             | PATH            | ON_FILE_PATH    |         |
| changelog       | changelog path  | FIR_APP_CHANGE  |         |
|                 | or content      | LOG             |         |
| open            | true/false if   | FIR_APP_OPEN    | true    |
|                 | open for        |                 |         |
|                 | everyone        |                 |         |
| password        | Set password    | FIR_APP_PASSWO  |         |
|                 | for app         | RD              |         |
| switch_to_qini  | switch to       | FIR_SWITCH_TO_  | false   |
| u               | qiniu upload    | QINIU           |         |
| need_release_i  | would build     | FIR_NEED_RELEA  | false   |
| d               | download url    | SE_ID           |         |
|                 | with release    |                 |         |
|                 | id              |                 |         |
| dingtalk_acces  | dingtalk_acces  | FIR_DINGTALK_A  |         |
| s_token         | s_token         | CCESS_TOKEN     |         |
| dingtalk_custo  | dingtalk        | FIR_DINGTALK_C  |         |
| m_message       | custom message  | USTOM_MESSAGE   |         |
| dingtalk_at_ph  | dingtalk at     | FIR_DINGTALK_A  |         |
| ones            | phones, split   | T_PHONES        |         |
|                 | with ','        |                 |         |
| dingtalk_at_al  | dingtalk at     | FIR_DINGTALK_A  |         |
| l               | all people      | T_ALL           |         |
| dingtalk_secre  | Dingtalk        | FIR_DINGTALK_S  |         |
| t               | secret code     | ECRET           |         |
|                 | (eg: SECxxxxx)  |                 |         |
| feishu_access_  | feishu_access_  | FIR_FEISHU_ACC  |         |
| token           | token           | ESS_TOKEN       |         |
| feishu_custom_  | feishu custom   | FIR_FEISHU_CUS  |         |
| message         | message         | TOM_MESSAGE     |         |
| wxwork_access_  | wechat work     | FIR_WXWORK_ACC  |         |
| token           | webhook         | ESS_TOKEN       |         |
|                 | access_token    |                 |         |
| wxwork_pic_url  | wechat work     | FIR_WXWORK_PIC  |         |
|                 | webhook pic     | _URL            |         |
|                 | url             |                 |         |
| wxwork_custom_  | wechat work     | FIR_WXWORK_CUS  |         |
| message         | custom message  | TOM_MESSAGE     |         |
+-----------------+-----------------+-----------------+---------+
```

#### Fastlane + Firimï¼ˆéå®˜æ–¹ç‰ˆï¼‰

- [Firim æ’ä»¶ï¼ˆéå®˜æ–¹ï¼‰](https://github.com/whlsxl/firim)
- [Firim æ’ä»¶ï¼ˆéå®˜æ–¹ï¼‰- fastlane](https://github.com/whlsxl/firim/tree/master/fastlane-plugin-firim)

```swift
/// æ·»åŠ  plugin æ’ä»¶
fastlane add_plugin firim
/// å¦‚æœä¸Šé¢å‡ºç°æŠ¥é”™ï¼Œåˆ™ä½¿ç”¨ä¸‹é¢æŒ‡ä»¤
sudo fastlane add_plugin firim
/// å¦‚æœä¸Šé¢å‡ºç°æŠ¥é”™ï¼Œåˆ™ä½¿ç”¨ä¸‹é¢æŒ‡ä»¤
sudo fastlane add_plugin -n /usr/local/bin/ firim

/// å®‰è£…è‡ªåŠ¨ä¸Šä¼  fir æ’ä»¶
gem install fir-cli
/// å¦‚æœä¸Šé¢æŒ‡ä»¤æŠ¥é”™ï¼Œåˆ™ä½¿ç”¨ä¸‹é¢æŒ‡ä»¤
sudo gem install fir-cli
/// å¦‚æœä¸Šé¢æŒ‡ä»¤æŠ¥é”™ï¼Œåˆ™ä½¿ç”¨ä¸‹é¢æŒ‡ä»¤
sudo gem install -n /usr/local/bin fir-cli

/// å¯¹åº” Fastfile é…ç½®
firim(firim_api_token: "xxxxxxx")
```

### å¸¸è§é”™è¯¯
#### æŠ¥é”™ï¼šYour Gemfile lists the gem fastlane-plugin-pgyer (>= 0) more than once.

å½“æ‰§è¡Œ `bundle install` æˆ– `bundle update` æ—¶å‡ºç°å¦‚ä¸‹æŠ¥é”™ï¼š

```swift
Your Gemfile lists the gem fastlane-plugin-pgyer (>= 0) more than once.
You should probably keep only one of them.
Remove any duplicate entries and specify the gem only once.
While it's not a problem now, it could cause errors if you change the version of one of them later.
```

éœ€è¦æ£€æŸ¥ä¸€ä¸‹ `Pluginfile` æ–‡ä»¶ï¼Œæ˜¯å¦é‡Œé¢æ·»åŠ äº†å¤šä¸ªï¼š

```swift
gem 'fastlane-plugin-pgyer'
```

åˆ é™¤å¤šä½™çš„ï¼Œé‡æ–°æ‰§è¡ŒæŒ‡ä»¤å³å¯ã€‚

#### æŠ¥é”™ï¼šzsh: command not found: fastlane

å¦‚æœåˆå§‹åŒ– `fastlane init` æ—¶æŠ¥è¯¥é”™è¯¯ï¼Œåˆ™ä½¿ç”¨å¦‚ä¸‹æŒ‡ä»¤ï¼š

```swift
/// é¦–å…ˆæµ‹è¯•ï¼š
sudo gem install fastlane
/// å¦‚æœä¸Šé¢æŒ‡ä»¤ä¸è¡Œï¼Œç”¨è¿™ä¸ª
sudo gem install -n /usr/local/bin fastlane
```

#### æŠ¥é”™ï¼šsh: xcpretty: command not found

å¦‚æœåœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­åŒ…è¯¥é”™è¯¯ï¼Œåˆ™ä½¿ç”¨å¦‚ä¸‹æŒ‡ä»¤ï¼š

```swift
sudo gem install xcpretty -n/usr/local/bin
```

#### æŠ¥é”™ï¼šerror: exportArchive: exportOptionsPlist error for key "iCloudContainerEnvironment": expected one of {Development, Production}, but no value was provided

å¦‚æœå‡ºç°äº†å¦‚ä¸‹æŠ¥é”™å¼•èµ·äº†æ‰“åŒ…å¤±è´¥ï¼Œåˆ™æ˜¯å› ä¸ºé¡¹ç›®å·¥ç¨‹ä¸­ä½¿ç”¨äº† `iCloud` äº‘å­˜å‚¨åŠŸèƒ½ï¼Œéœ€è¦è¿›è¡Œç‰¹æ®Šé…ç½®ï¼Œé…ç½®å¦‚ä¸‹ï¼š

```swift
/// é¡¹ç›®å·¥ç¨‹ä¸­å¼•å…¥ iCloud æ—¶ä½¿ç”¨ï¼Œå¯é€‰å‚æ•°æœ‰ Developmentã€Production
export_options: {iCloudContainerEnvironment: "Production"},
export_xcargs: "-allowProvisioningUpdates"
```

```swift
error: exportArchive: exportOptionsPlist error for key "iCloudContainerEnvironment": expected one of {Development, Production}, but no value was provided

Error Domain=IDEFoundationErrorDomain Code=1 "exportOptionsPlist error for key "iCloudContainerEnvironment": expected one of {Development, Production}, but no value was provided" UserInfo={NSLocalizedDescription=exportOptionsPlist error for key "iCloudContainerEnvironment": expected one of {Development, Production}, but no value was provided}
```

#### æŠ¥é”™ï¼šThe call to the iTMSTransporter completed with a non-zero exit status: 1. This indicates a failure.

- [å‚è€ƒèµ„æ–™ï¼šStackoverflow - iTunes Transporter error: Could not resolve module: com.apple.transporter.starterï¼ˆæœ‰æ•ˆï¼‰](https://stackoverflow.com/questions/70950473/itunes-transporter-error-could-not-resolve-module-com-apple-transporter-starte)
- [å‚è€ƒèµ„æ–™ï¼šApple Developer - Transporter error after home folder renamingï¼ˆæœ‰æ•ˆï¼‰](https://developer.apple.com/forums/thread/129378?answerId=419847022#419847022)
- [å‚è€ƒèµ„æ–™ï¼šStackoverflow - Fastlane upload_to_testflight The call to the iTMSTransporter completed with a non-zero exit status: 1. This indicates a failureï¼ˆæ— æ•ˆï¼‰](https://stackoverflow.com/questions/66059470/fastlane-upload-to-testflight-the-call-to-the-itmstransporter-completed-with-a-n)
- [å‚è€ƒèµ„æ–™ï¼šStackoverflow - Fabric Fastlane Pilot Upload iTMSTransporter failureï¼ˆæ— æ•ˆï¼‰](https://stackoverflow.com/questions/45189547/fabric-fastlane-pilot-upload-itmstransporter-failure)

å¦‚æœä¸Šä¼  `TestFlight` æ—¶å‡ºç°å¦‚ä¸‹æŠ¥é”™ï¼š

```swift
[10:01:37]: This might take a few minutes. Please don't interrupt the script.
[10:01:44]: [iTMSTransporter] 	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
[10:01:44]: [iTMSTransporter] 	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)
[10:01:44]: [iTMSTransporter] 	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)
[10:01:44]: [iTMSTransporter] 	at java.base/java.lang.reflect.Method.invoke(Unknown Source)
[10:01:44]: [iTMSTransporter] 	at com.apple.transporter.bootstrap.BootstrapperPhase1.bootstrap(BootstrapperPhase1.java:107)
[10:01:44]: [iTMSTransporter] 	at com.apple.transporter.bootstrap.BootstrapperPhase1.bootstrap(BootstrapperPhase1.java:78)
[10:01:44]: [iTMSTransporter] 	at com.apple.transporter.launcher.Launcher.launchBootstrapper(Launcher.java:37)
[10:01:44]: [iTMSTransporter] 	... 6 more
[10:01:44]: [iTMSTransporter] Caused by: java.lang.NullPointerException
[10:01:44]: [iTMSTransporter] 	at com.apple.transporter.bootstrap.BootstrapperPhase2.bootstrapBundles(BootstrapperPhase2.java:284)
[10:01:44]: [iTMSTransporter] 	at com.apple.transporter.bootstrap.BootstrapperPhase2.start(BootstrapperPhase2.java:163)
[10:01:44]: [iTMSTransporter] 	at com.apple.transporter.bootstrap.BootstrapperPhase1.startOSGiFramework(BootstrapperPhase1.java:399)
[10:01:44]: [iTMSTransporter] 	at com.apple.transporter.bootstrap.BootstrapperPhase1.realBootstrap(BootstrapperPhase1.java:225)
[10:01:44]: [iTMSTransporter] 	at com.apple.transporter.bootstrap.BootstrapperPhase1.bootstrap(BootstrapperPhase1.java:86)
[10:01:44]: [iTMSTransporter] 	... 13 more
[10:01:44]: iTunes Transporter output above ^
[10:01:44]: could not download
The call to the iTMSTransporter completed with a non-zero exit status: 1. This indicates a failure.
+--------------------+----------------------------------------------------------------------+
|                                       Lane Context                                        |
+--------------------+----------------------------------------------------------------------+
| DEFAULT_PLATFORM   | ios                                                                  |
| PLATFORM_NAME      | ios                                                                  |
| LANE_NAME          | ios export_ipa                                                       |
| IPA_OUTPUT_PATH    | /Users/mxgx/Documents/GitHub/JJCComicBook/Code/JJCComicBook/fastlan  |
|                    | e/package/JJCComicBook.ipa                                           |
| XCODEBUILD_ARCHIVE | /Users/mxgx/Library/Developer/Xcode/Archives/2022-05-07/JJCComicBoo  |
|                    | k 2022-05-07 09.55.29.xcarchive                                      |
| DSYM_OUTPUT_PATH   | /Users/mxgx/Documents/GitHub/JJCComicBook/Code/JJCComicBook/fastlan  |
|                    | e/package/JJCComicBook.app.dSYM.zip                                  |
+--------------------+----------------------------------------------------------------------+
[10:01:45]: Error uploading ipa file: 
+------+---------------------------+-------------+
|                fastlane summary                |
+------+---------------------------+-------------+
| Step | Action                    | Time (in s) |
+------+---------------------------+-------------+
| 1    | default_platform          | 0           |
| 2    | gym                       | 368         |
| 3    | notification              | 0           |
| 4    | app_store_connect_api_key | 0           |
| ğŸ’¥   | upload_to_testflight      | 11          |
+------+---------------------------+-------------+
[10:01:45]: fastlane finished with errors
[!] Error uploading ipa file: 
```
![Fastlane - ä¸Šä¼  TestFlight å¤±è´¥](/images/iOS/2022-05-07-Fastlane-08.png)

è™½ç„¶ä»ç½‘ä¸ŠæŸ¥æ‰¾å¥½å¤šï¼Œéƒ½æ˜¯è¯´æ˜¯å› ä¸ºç½‘ç»œæˆ–é˜²ç«å¢™å¼•èµ·çš„ï¼ˆæ¯”å¦‚ï¼š[Stackoverflow - Fastlane upload_to_testflight The call to the iTMSTransporter completed with a non-zero exit status: 1. This indicates a failure](https://stackoverflow.com/questions/66059470/fastlane-upload-to-testflight-the-call-to-the-itmstransporter-completed-with-a-n)ï¼‰ï¼Œä½†æ˜¯å®é™…ä¸Šæ— è®ºåˆ‡æ¢ç½‘ç»œè¿˜æ˜¯å…³é—­é˜²ç«å¢™ï¼Œéƒ½æ²¡æœ‰è§£å†³é—®é¢˜ã€‚

è€Œæœ‰çš„åˆ™æ˜¯è¯´éœ€è¦åœ¨ `fane` action å‰åŠ ä¸€äº›å˜é‡ï¼ˆæ¯”å¦‚ï¼š[Stackoverflow - Fabric Fastlane Pilot Upload iTMSTransporter failure](https://stackoverflow.com/questions/45189547/fabric-fastlane-pilot-upload-itmstransporter-failure)ï¼‰ï¼Œå®é™…ä¸Šä¹Ÿæ˜¯æ²¡æœ‰è§£å†³é—®é¢˜ã€‚

æœ€ç»ˆè§£å†³çš„åŠæ³•æ˜¯ç§»é™¤å¯¹åº”çš„ `iTMSTransporter` ç›¸å…³æ–‡ä»¶ï¼Œå†æ¬¡æ‰§è¡ŒæŒ‡ä»¤å°±å¯ä»¥äº†ã€‚
å‚è€ƒé“¾æ¥ï¼š
- [Stackoverflow - iTunes Transporter error: Could not resolve module: com.apple.transporter.starter](https://stackoverflow.com/questions/70950473/itunes-transporter-error-could-not-resolve-module-com-apple-transporter-starte)
- [Apple Developer - Transporter error after home folder renaming](https://developer.apple.com/forums/thread/129378?answerId=419847022#419847022)

è§£å†³åŠæ³•å¦‚ä¸‹ï¼š

```swift
/// ä¼˜å…ˆåˆ é™¤å¦‚ä¸‹æ–‡ä»¶å¤¹ï¼Œç„¶åå†æ¬¡æ‰§è¡Œç¼–è¯‘
~/Library/Caches/com.apple.amp.itmstransporter
/// å¦‚æœä¸Šé¢çš„æ–¹å¼ä¸è¡Œï¼Œåˆ™æ‰§è¡Œä¸‹é¢
~Library/Caches/com.apple.TransporterApp
~Library/Preferences/com.apple.TransporterApp.plist
~Library/Application Support/com.apple.TransporterApp
```
![Fastlane - ä¸Šä¼  TestFlight æˆåŠŸ](/images/iOS/2022-05-07-Fastlane-09.png)

#### æŠ¥é”™ï¼š[!] Unresolved conflict between options: 'api_key' and 'username'

è¿™æ˜¯ç”±äºåœ¨é…ç½® `fastlane` ä¸Šä¼  `TestFlight` æ—¶ï¼ŒåŒæ—¶é…ç½®äº† `key_id` å’Œ `usernameã€app_identifier` ä¸¤ä¸ªå‚æ•°å¼•èµ·çš„ï¼Œä¸¤è€…ä¸èƒ½åŒæ—¶å­˜åœ¨ï¼Œåªèƒ½å•ç‹¬é…ç½®ä¸€è€…ï¼Œåªéœ€è¦åˆ é™¤å…¶ä¸­ä¸€ä¸ªå°±è¡Œäº†ã€‚

#### æŠ¥é”™ï¼šError loading plugin 'fastlane-plugin-pgyer': Permission denied @ rb_sysopen - /usr/local/lib/ruby/gems/2.7.0/cache/fastlane-plugin-pgyer-0.2.2.gem

å¦‚æœç›´æ¥ä½¿ç”¨ `fastlane add_plugin pgyer` æŒ‡ä»¤çš„è¯ï¼Œæœ‰æ—¶å€™ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š

```swift
Fetching fastlane-plugin-pgyer-0.2.2.gem
#<Thread:0x00007fc49e857478 /usr/local/Cellar/ruby/2.7.1_2/lib/ruby/2.7.0/rubygems/request_set.rb:168 run> terminated with exception (report_on_exception is true):
Traceback (most recent call last):
	8: from /usr/local/Cellar/ruby/2.7.1_2/lib/ruby/2.7.0/rubygems/request_set.rb:174:in `block (2 levels) in install'
	7: from /usr/local/Cellar/ruby/2.7.1_2/lib/ruby/2.7.0/rubygems/resolver/specification.rb:101:in `download'
	6: from /usr/local/Cellar/ruby/2.7.1_2/lib/ruby/2.7.0/rubygems/source.rb:207:in `download'
	5: from /usr/local/Cellar/ruby/2.7.1_2/lib/ruby/2.7.0/rubygems/remote_fetcher.rb:154:in `download'
	4: from /usr/local/Cellar/ruby/2.7.1_2/lib/ruby/2.7.0/rubygems/remote_fetcher.rb:306:in `cache_update_path'
	3: from /usr/local/Cellar/ruby/2.7.1_2/lib/ruby/2.7.0/rubygems.rb:885:in `write_binary'
	2: from /usr/local/Cellar/ruby/2.7.1_2/lib/ruby/2.7.0/open-uri.rb:21:in `open'
	1: from /usr/local/Cellar/ruby/2.7.1_2/lib/ruby/2.7.0/open-uri.rb:21:in `open'
/usr/local/Cellar/ruby/2.7.1_2/lib/ruby/2.7.0/open-uri.rb:21:in `initialize': Permission denied @ rb_sysopen - /usr/local/lib/ruby/gems/2.7.0/cache/fastlane-plugin-pgyer-0.2.2.gem (Errno::EACCES)
[14:42:01]: Error loading plugin 'fastlane-plugin-pgyer': Permission denied @ rb_sysopen - /usr/local/lib/ruby/gems/2.7.0/cache/fastlane-plugin-pgyer-0.2.2.gem
+-----------------------+-----------+------------------+
|                     Used plugins                     |
+-----------------------+-----------+------------------+
| Plugin                | Version   | Action           |
+-----------------------+-----------+------------------+
| fastlane-plugin-fir   | 0.3.0     | fir              |
| fastlane-plugin-pgyer | undefined | No actions found |
+-----------------------+-----------+------------------+

[!] No actions were found while loading one or more plugins
    Please use `bundle exec fastlane` with plugins
    More info - https://docs.fastlane.tools/plugins/using-plugins/#run-with-plugins
```

![Fastlane - å®‰è£… pgyer æ’ä»¶å¤±è´¥](/images/iOS/2022-05-07-Fastlane-10.png)

è€Œå½“æ·»åŠ  `sudo` ç®¡ç†å‘˜æƒé™çš„æŒ‡ä»¤åï¼Œå°±å¯ä»¥å®‰è£…æˆåŠŸäº†ã€‚

```swift
{22-05-06 14:42}mxgx:~/FastlaneDemo mxgx% sudo fastlane add_plugin pgyer
Password:
[âœ”] ğŸš€ 
[14:42:34]: fastlane detected a Gemfile in the current directory
[14:42:34]: However, it seems like you didn't use `bundle exec`
[14:42:34]: To launch fastlane faster, please use
[14:42:34]: 
[14:42:34]: $ bundle exec fastlane add_plugin pgyer
[14:42:34]: 
[14:42:34]: Get started using a Gemfile for fastlane https://docs.fastlane.tools/getting-started/ios/setup/#use-a-gemfile
[14:42:37]: Installing Ruby gem 'fastlane-plugin-pgyer'...
Fetching fastlane-plugin-pgyer-0.2.2.gem
[14:42:39]: Successfully installed 'fastlane-plugin-pgyer'
+-----------------------+---------+--------+
|               Used plugins               |
+-----------------------+---------+--------+
| Plugin                | Version | Action |
+-----------------------+---------+--------+
| fastlane-plugin-fir   | 0.3.0   | fir    |
| fastlane-plugin-pgyer | 0.2.2   | pgyer  |
+-----------------------+---------+--------+
```

#### æŠ¥é”™ï¼šPermission denied @ rb_sysopen - /usr/local/lib/ruby/gems/2.7.0/cache/admqr_knife-0.1.5.gem (Errno::EACCES)

ç”±äºä½¿ç”¨ `gem install fir-cli` å®‰è£… `fir` è‡ªåŠ¨ä¸Šä¼  `CI` æ—¶æƒé™å¼•å‘çš„ï¼Œä½¿ç”¨å¦‚ä¸‹æŒ‡ä»¤å³å¯ï¼š

```swift
sudo gem install fir-cli
/// æˆ–
sudo gem install -n /usr/local/bin fir-cli
```

#### æŠ¥é”™ï¼šCould not find action, lane or variable 'xxx'

è¡¨ç¤ºæœªæŸ¥è¯¢åˆ°å¯¹åº”çš„ `plugin` æ’ä»¶ï¼Œéœ€è¦é‡æ–°ä¸‹è½½ï¼Œå¯ä»¥é€šè¿‡ `fastlane action` æŸ¥è¯¢å½“å‰å·²ç»å®‰è£…çš„æ’ä»¶ï¼Œå¦‚æœæ²¡æœ‰å¯¹åº”çš„æ’ä»¶ï¼Œåˆ™é‡æ–°å®‰è£…å³å¯ã€‚

#### æŠ¥é”™ï¼šå…¶ä»–æŠ¥é”™ 1

å¦‚æœæŠ¥å¦‚ä¸‹é”™è¯¯ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯ `Appflie` æˆ– `Fastfile` æ–‡ä»¶é…ç½®ä¸æ­£ç¡®ï¼Œéœ€è¦ä»”ç»†æ ¸æŸ¥ï¼š

```swift
+------------------+----------------+
|           Lane Context            |
+------------------+----------------+
| DEFAULT_PLATFORM | iOS            |
| PLATFORM_NAME    | iOS            |
| LANE_NAME        | iOS hs_release |
+------------------+----------------+
[11:01:40]: Error building the application - see the log above

+------+------------------+-------------+
|           fastlane summary            |
+------+------------------+-------------+
| Step | Action           | Time (in s) |
+------+------------------+-------------+
| 1    | default_platform | 0           |
| ğŸ’¥   | gym              | 15          |
+------+------------------+-------------+

[11:01:41]: fastlane finished with errors

[!] Error building the application - see the log above
```

#### æŠ¥é”™ï¼šå…¶ä»–æŠ¥é”™ 2

å¦‚æœæŠ¥å¦‚ä¸‹é”™è¯¯ï¼Œæš‚æ—¶æ²¡æ‰¾åˆ°è§£å†³åŠæ³•ï¼š

```swift
2022-05-05 11:01:34.455 xcodebuild[44781:25956942] Requested but did not find extension point with identifier Xcode.IDEKit.ExtensionSentinelHostApplications for extension Xcode.DebuggerFoundation.AppExtensionHosts.watchOS of plug-in com.apple.dt.IDEWatchSupportCore
2022-05-05 11:01:34.456 xcodebuild[44781:25956942] Requested but did not find extension point with identifier Xcode.IDEKit.ExtensionPointIdentifierToBundleIdentifier for extension Xcode.DebuggerFoundation.AppExtensionToBundleIdentifierMap.watchOS of plug-in com.apple.dt.IDEWatchSupportCore
```