---
layout: post
title: 【iOS】Fastlane 自动化打包神器（2022.05.07 更新）
categories: iOS
description: Fastlane 自动化打包 TestFlight、蒲公英、Fir.im 平台
keywords: iOS, iOS配置, Fastlane, TestFlight
topmost: true
---

**导读：** 
在自动化打包的路途中，`Fastlane` 绝对是神器中的神器。

# fastlane

![Fastlane](/images/iOS/2022-05-07-Fastlane-01.png)

### fastlane 相关资料

- [fastlane - 官方文档](https://docs.fastlane.tools/)
- [fastlane - iOS](https://docs.fastlane.tools/getting-started/ios/setup/)
- [fastlane - Appfile](https://docs.fastlane.tools/advanced/#appfile)
- [fastlane - actions](https://docs.fastlane.tools/actions)
- [fastlane - available plugins](https://docs.fastlane.tools/plugins/available-plugins)
- [Fastlane - plugins](https://docs.fastlane.tools/plugins/using-plugins/)
- []()
- [Homebrew Formulae - fastlane](https://formulae.brew.sh/formula/fastlane)
- [蒲公英官网](https://www.pgyer.com/)
- [Fir.im - 官网](https://www.betaqr.com/)
- [Fir.im - 关于 fir.im fastlane 插件的一些说明](https://blog.betaqr.com/guan-yu-fastlane-cha-jian-wen-ti/)
- [Firim 插件（非官方）](https://github.com/whlsxl/firim)
- [Firim 插件（非官方）- fastlane](https://github.com/whlsxl/firim/tree/master/fastlane-plugin-firim)
- []()
- [掘金 - 使用 fastlane 实现自动化打包（推荐）](https://juejin.cn/post/6844903607343513608) 
- [掘金 - iOS+Fastlane自动打包发布到TestFlight](https://juejin.cn/post/7021167923632799758)
- [掘金 - iOS+Fastlane自动打包发布测试、消息通知，完美结合！](https://juejin.cn/post/7008553785672859656)
- [简书 - iOS(Swift) fastlane集成,分发蒲公英,fir(一)](https://www.jianshu.com/p/d9a3c42d9af0)
- [简书 - iOS(Swift) fastlane集成,发送 testflight(二)](https://www.jianshu.com/p/e60b1d3e7c69)
- [简书 - iOS自动化打包发布（Fastlane + 蒲公英）](https://www.jianshu.com/p/2f25cb15ee12)
- [简书 - iOS App配置多环境变量 + 使用fastlane快速打包并上传蒲公英/AppStore](https://www.jianshu.com/p/51fd90f97c8a)
- [简书 - iOS 自动化打包（fastlane），真香定律](https://www.jianshu.com/p/4f63e8c26af8)
- []()
- [参考资料：There is a variety of ways to install Ruby without having to modify your system environment](https://www.ruby-lang.org/en/documentation/installation/#managers)
- [参考资料：Permission denied @ rb_sysopen - /Library/Ruby/Gems/2.3.0/cache/rack-2.0.4.gem](https://www.jianshu.com/p/64cfc0d78fe8)
- [参考资料：Stackoverflow - iTunes Transporter error: Could not resolve module: com.apple.transporter.starter（有效）](https://stackoverflow.com/questions/70950473/itunes-transporter-error-could-not-resolve-module-com-apple-transporter-starte)
- [参考资料：Apple Developer - Transporter error after home folder renaming（有效）](https://developer.apple.com/forums/thread/129378?answerId=419847022#419847022)
- [参考资料：Stackoverflow - Fastlane upload_to_testflight The call to the iTMSTransporter completed with a non-zero exit status: 1. This indicates a failure（无效）](https://stackoverflow.com/questions/66059470/fastlane-upload-to-testflight-the-call-to-the-itmstransporter-completed-with-a-n)
- [参考资料：Stackoverflow - Fabric Fastlane Pilot Upload iTMSTransporter failure（无效）](https://stackoverflow.com/questions/45189547/fabric-fastlane-pilot-upload-itmstransporter-failure)

### fastlane 环境配置
#### 配置 Xcode command line tools (macOS)

`fastlane` 在 `iOS端` 打包，是需要依托于 `Xcode` 的 `Xcode command line tools (macOS)` 工具的，所以需要提前安装：

```swift
/// 安装 Xcode command line tools 指令
xcode-select --install
```

如果出现如下报错，则代表当前已安装了 `Xcode command line tools (macOS)`，无需再次安装：

```swift
/// 当前已安装 Xcode command line tools 工具
xcode-select: error: command line tools are already installed, use "Software Update" to install updates
```

如果电脑中出现了多个 Xcode，可能有时候还需要选择指定的 Xcode 进行编译打包：

```swift
/// 查询当前路径
xcode-select -p
/// 选择指定路径
sudo xcode-select -s /Library/Developer/CommandLineTools/
```

#### 安装 fastlane

官方提供了多种安装方式，分别有：
- `Managed Ruby environment + Bundler (macOS/Linux/Windows)【官方推荐】`
- `Homebrew (macOS)`
- `System Ruby + RubyGems (macOS/Linux/Windows)【官方不推荐】`


**System Ruby + RubyGems (macOS/Linux/Windows)【官方不推荐】**

```swift
/// 虽然官方不推荐，但是仍可以使用
sudo gem install fastlane
```

**Homebrew (macOS)**

- [参考资料：Homebrew Formulae - fastlane](https://formulae.brew.sh/formula/fastlane)

```swift
/// 查询当前 homebrew 版本
brew -v
/// 无需安装 Ruby，但是无法跨平台
brew install fastlane
```

**Managed Ruby environment + Bundler (macOS/Linux/Windows)【官方推荐】**

- [参考资料：There is a variety of ways to install Ruby without having to modify your system environment](https://www.ruby-lang.org/en/documentation/installation/#managers)

官方声明并不推荐使用系统内置 `（system Ruby）` 的 `Ruby`，而 `rbenv` 则是用来管理 ruby 环境的工具（`rbenv is one of the most popular ways to manage your Ruby environment.`）。

同时 fastlane 要求 ruby 环境必须是 `2.5及以上` 的版本（`fastlane supports Ruby versions 2.5 or newer`）。

```swift
/// 检查 ruby 版本
ruby --version
/// ruby 2.7.1p83 (2020-03-31 revision a0c7c23c9c) [x86_64-darwin19]
```

官方推荐使用 `Bundler + Gemfile` 管理 fastlane 的依赖问题。

```swift
/// 安装 Bundler
gem install bundler
```

然后在项目工程根目录下，创建一个 `Gemfile` 文件，添加如下内容：

```swift
source "https://rubygems.org"
gem "fastlane"
```

接着执行如下指令，会得到 `Gemfile` 和 `Gemfile.lock` 两个文件用于管理版本：

```swift
/// 执行运行指令
bundle update

/// 第一次编译
bundle install
/// 更新 fastlane
bundle update fastlane
```

再之后，则根据需求执行对应的 `lane action` 方法：

```swift
/// 执行 lane action
bundle exec fastlane xxx
```

#### fastlane 初始化

`cd` 到项目根目录，执行如下指令：

```swift
fastlane init
```

会得到如下结果，同时根目录下会产生一个 `fastlane` 文件夹：

```swift
{22-05-05 17:53}mxgx:~/FastlaneDemo@dev✗✗✗✗✗✗ mxgx% fastlane init
[✔] 🚀 
[✔] Looking for iOS and Android projects in current directory...
[17:53:37]: Created new folder './fastlane'.
[17:53:37]: Detected an iOS/macOS project in the current directory: 'FastlaneDemo.xcworkspace'
[17:53:37]: -----------------------------
[17:53:37]: --- Welcome to fastlane 🚀 ---
[17:53:37]: -----------------------------
[17:53:37]: fastlane can help you with all kinds of automation for your mobile app
[17:53:37]: We recommend automating one task first, and then gradually automating more over time
[17:53:37]: What would you like to use fastlane for?
1. 📸  Automate screenshots
2. 👩‍✈️  Automate beta distribution to TestFlight
3. 🚀  Automate App Store distribution
4. 🛠  Manual setup - manually setup your project to automate your tasks
?  4
[17:55:29]: ------------------------------------------------------------
[17:55:29]: --- Setting up fastlane so you can manually configure it ---
[17:55:29]: ------------------------------------------------------------
[17:55:29]: --------------------------------------------------------
[17:55:29]: --- ✅  Successfully generated fastlane configuration ---
[17:55:29]: --------------------------------------------------------
[17:55:29]: Generated Fastfile at path `./fastlane/Fastfile`
[17:55:29]: Generated Appfile at path `./fastlane/Appfile`
[17:55:29]: Gemfile and Gemfile.lock at path `Gemfile`
[17:55:29]: Please check the newly generated configuration files into git along with your project
[17:55:29]: This way everyone in your team can benefit from your fastlane setup
[17:55:29]: Continue by pressing Enter ⏎

[17:55:36]: fastlane will collect the number of errors for each action to detect integration issues
[17:55:36]: No sensitive/private information will be uploaded, more information: https://docs.fastlane.tools/#metrics
[17:55:36]: ----------------------
[17:55:36]: --- fastlane lanes ---
[17:55:36]: ----------------------
[17:55:36]: fastlane uses a `Fastfile` to store the automation configuration
[17:55:36]: Within that, you'll see different lanes.
[17:55:36]: Each is there to automate a different task, like screenshots, code signing, or pushing new releases
[17:55:36]: Continue by pressing Enter ⏎

[17:55:52]: --------------------------------------
[17:55:52]: --- How to customize your Fastfile ---
[17:55:52]: --------------------------------------
[17:55:52]: Use a text editor of your choice to open the newly created Fastfile and take a look
[17:55:52]: You can now edit the available lanes and actions to customize the setup to fit your needs
[17:55:52]: To get a list of all the available actions, open https://docs.fastlane.tools/actions
[17:55:52]: Continue by pressing Enter ⏎

[17:55:54]: ------------------------------
[17:55:54]: --- Where to go from here? ---
[17:55:54]: ------------------------------
[17:55:54]: 📸  Learn more about how to automatically generate localized App Store screenshots:
[17:55:54]: 		https://docs.fastlane.tools/getting-started/ios/screenshots/
[17:55:54]: 👩‍✈️  Learn more about distribution to beta testing services:
[17:55:54]: 		https://docs.fastlane.tools/getting-started/ios/beta-deployment/
[17:55:54]: 🚀  Learn more about how to automate the App Store release process:
[17:55:54]: 		https://docs.fastlane.tools/getting-started/ios/appstore-deployment/
[17:55:54]: 👩‍⚕️  Learn more about how to setup code signing with fastlane
[17:55:54]: 		https://docs.fastlane.tools/codesigning/getting-started/
[17:55:54]: 
[17:55:54]: To try your new fastlane setup, just enter and run
[17:55:54]: $ fastlane custom_lane
```

此时代表初始化成功了，同时 `fastlane` 文件夹下会多出两个文件 `Appfile` 和 `Fastfile` 用来自定义配置的。

此处介绍一下：

```swift
/// 使用 fastlane 做什么？
[17:53:37]: What would you like to use fastlane for?
/// 选项1：自动截屏，能帮我们自动截取 APP 中的截图，并添加手机边框（如果需要的话）
1. 📸  Automate screenshots
/// 选项2：自动发布 beta 版本用于 TestFlight
2. 👩‍✈️  Automate beta distribution to TestFlight
/// 选项3：自动发布到 AppStore
3. 🚀  Automate App Store distribution
/// 选项4：手动配置（貌似当下所有的教程都是默认选这个的）
4. 🛠  Manual setup - manually setup your project to automate your tasks
?  4
```

#### fastlane 手动配置

##### Appfile

- [参考资料：Fastlane - Appfile](https://docs.fastlane.tools/advanced/#appfile)

```swift
/// Bundle Identifier
app_identifier "Bundle Identifier"
/// 开发者账户 AppleID 对应的邮箱
apple_id "开发者 AppleID 邮箱"
/// TeamID：可以通过 KeyChain 中的 .cer 证书文件中显示 () 括号中的十位字符串，但是看官方教程，并没有添加此项
team_id "xxxx"
```

##### Fastfile

- [参考资料：Fastlane - actions](https://docs.fastlane.tools/actions)
- [参考资料：Fastlane - available plugins](https://docs.fastlane.tools/plugins/available-plugins)

```swift
/// Fastfile - 打包 + 发布 testflight + pgyer + firim
# update_fastlane
default_platform(:ios)
platform :ios do 
  # 打包 + 发布 testflight + pgyer + firim
  desc "Push a new build to TestFlight、pgyer、fir.im."
  lane :release_all do
    release_gym
    upload_testflight
    upload_pgyer
    upload_firim
  end

  # 打包 + 发布 testflight
  desc "Push a new build to TestFlight."
  lane :release_testflight do
    release_gym
    upload_testflight
  end

  # 打包 + 发布 pgyer
  desc "Push a new build to Pgyer."
  lane :release_pgyer do
    release_gym
    upload_pgyer
  end

  # 打包 + 发布 firim
  desc "Push a new build to Fir.im."
  lane :release_firim do
    release_gym
    upload_firim
  end

  # 打包
  desc "Push a new build to gym."
  lane :release_gym do
    puts "--- 【Notice】gym start -------------------------"
    gym(
      clean: true,
      output_directory: "./fastlane/package",
      scheme: "JJCComicBook",
      workspace: "JJCComicBook.xcworkspace",
      configuration: "Release",
      export_method: "app-store",
      export_options: {iCloudContainerEnvironment: "Production"},
      export_xcargs: "-allowProvisioningUpdates"
    )
    puts "--- 【Notice】gym end -------------------------"

    # mac上的通知弹窗，通知打包完毕
    notification(app_icon: "./fastlane/icon.png", title: "苜蓿漫画", subtitle: "打包成功，已导出安装包", message: "准备发布中……")
  end

  # 上传到 TestFlight
  desc "Push a new build to upload TestFlight."
  lane :upload_testflight do
    puts "--- 【Notice】upload testflight start -------------------------"
    updateVersionDes = "苜蓿苜蓿_v2.0.4(2)\n1、修复部分漫源失效问题；\n2、优化细节问题。"
    api_key = app_store_connect_api_key(
      key_id: "7Z7YBJ8T4S", 
      issuer_id: "5313c630-7018-45ac-96e3-8bed54f2af68",
      key_filepath: "./fastlane/JJCComicBook_API_Key_Developer.p8",
      duration: 1200,
      in_house: false
    )
    upload_to_testflight(
      api_key: api_key,
      skip_waiting_for_build_processing: true,
      # username: "jijiucheng666@163.com",
      # app_identifier: "com.jijiucheng.JJCComicBook",
      ipa: "./fastlane/package/JJCComicBook.ipa",
      skip_submission:true,
      beta_app_description: updateVersionDes
    )
    puts "--- 【Notice】upload testflight end -------------------------"
  end

  # 上传到蒲公英发布平台
  desc "Push a new build to upload Pgyer."
  lane :upload_pgyer do
    puts "--- 【Notice】upload pgyer start -------------------------"
    updateVersionDes = "苜蓿苜蓿_v2.0.4(2)\n1、修复部分漫源失效问题；\n2、优化细节问题。"
    pgyer(
      api_key: "effa09759cb507ece7ff7c791d3528f8",
      user_key: "8079af61ce98d89172e0aa5318f935c5",
      update_description: updateVersionDes
    )
    puts "--- 【Notice】upload pgyer end -------------------------"
  end

  # 上传到 fir.im 发布平台
  desc "Push a new build to upload Fir.im."
  lane :upload_firim do
    puts "--- 【Notice】upload fir.im start -------------------------"
    updateVersionDes = "苜蓿苜蓿_v2.0.4(2)\n1、修复部分漫源失效问题；\n2、优化细节问题。"
    fir_cli(
      api_token: "df347b91ebcfccd894b6b176f410f061", 
      changelog: updateVersionDes
    )
    puts "--- 【Notice】upload fir.im end -------------------------"
  end
end
```

```Swift
/// Fastfile 
# update_fastlane
default_platform(:ios)
platform :ios do 
  # 打包 + 发布 testflight + pgyer + firim
  desc "Push a new build to TestFlight、pgyer、fir.im."
  lane :release_all do
    release_gym
    upload_testflight
    upload_pgyer
    upload_firim
  end

  # 打包 + 发布 testflight
  desc "Push a new build to TestFlight."
  lane :release_testflight do
    release_gym
    upload_testflight
  end

  # 打包 + 发布 pgyer
  desc "Push a new build to Pgyer."
  lane :release_pgyer do
    release_gym
    upload_pgyer
  end

  # 打包 + 发布 firim
  desc "Push a new build to Fir.im."
  lane :release_firim do
    release_gym
    upload_firim
  end

  # 打包
  desc "Push a new build to gym."
  lane :release_gym do
    puts "--- 【Notice】gym start -------------------------"
    gym(
      # 每次编译打包前是否进行清理缓存
      clean: true,
      # 输出 .ipa 包文件路径
      output_directory: "./fastlane/package",
      # 项目工程名称，如果设定多个 scheme 的时候，该参数会不同
      scheme: "JJCComicBook",
      # # 输出的 ipa 名称，可以不添加，会默认根据 scheme 来确定
      # output_name:"JJCComicBook.ipa",
      # 如果项目中使用了 Cocoapods 需要添加此参数
      workspace: "JJCComicBook.xcworkspace",
      # 配置打包环方式，Release、Debug、Test、PreRelease
      configuration: "Release",
      # 配置打包输出方式，目前支持：app-store、package、ad-hoc、enterprise、development
      export_method: "app-store",
      # # 在构建时隐藏终端不必要输出的信息
      # silent: false,
      # 其他配置信息
      # 当项目中使用了 iCloud 的时候，需要添加 iCloudContainerEnvironment 参数，参数值有 Production、Development
      export_options: {iCloudContainerEnvironment: "Production"},
      # 如果有多个参数，可以使用 xcargs: ["xxx", "xxx"] 的方式
      export_xcargs: "-allowProvisioningUpdates"
    )
    puts "--- 【Notice】gym end -------------------------"

    # mac上的通知弹窗，通知打包完毕
    notification(app_icon: "./fastlane/icon.png", title: "苜蓿漫画", subtitle: "打包成功，已导出安装包", message: "准备发布中……")
  end

  # 上传到 TestFlight
  desc "Push a new build to upload TestFlight."
  lane :upload_testflight do
    puts "--- 【Notice】upload testflight start -------------------------"
    updateVersionDes = "苜蓿苜蓿_v2.0.4(2)\n1、修复部分漫源失效问题；\n2、优化细节问题。"
    api_key = app_store_connect_api_key(
      # AppStore Connect 密钥相关参数
      key_id: "7Z7YBJ8T4S", 
      issuer_id: "5313c630-7018-45ac-96e3-8bed54f2af68",
      # 密钥文件路径
      key_filepath: "./fastlane/JJCComicBook_API_Key_Developer.p8",
      # 可选，最大值 = 1200
      duration: 1200,
      # 可选，but may be required if using match/sigh
      in_house: false
    )
    upload_to_testflight(
      api_key: api_key,
      skip_waiting_for_build_processing: true,
      # # username、app_identifier 和 api_key 不能同时存在，否则会报错
      # username: "jijiucheng666@163.com",
      # app_identifier: "com.jijiucheng.JJCComicBook",
      # 要上传到 testflight 的包路径
      ipa: "./fastlane/package/JJCComicBook.ipa",
      # 是否忽略直接提交审核
      skip_submission:true,
      # 
      beta_app_description: updateVersionDes
    )
    puts "--- 【Notice】upload testflight end -------------------------"
  end

  # 上传到蒲公英发布平台
  desc "Push a new build to upload Pgyer."
  lane :upload_pgyer do
    puts "【Notice】upload pgyer start -------------------------"
    updateVersionDes = "苜蓿苜蓿_v2.0.4(2)\n1、修复部分漫源失效问题；\n2、优化细节问题。"
    pgyer(
      api_key: "effa09759cb507ece7ff7c791d3528f8",
      user_key: "8079af61ce98d89172e0aa5318f935c5",
      update_description: updateVersionDes
    )
    puts "--- 【Notice】upload pgyer end -------------------------"
  end

  # 上传到 fir.im 发布平台
  desc "Push a new build to upload Fir.im."
  lane :upload_firim do
    puts "--- 【Notice】upload fir.im start -------------------------"
    updateVersionDes = "苜蓿苜蓿_v2.0.4(2)\n1、修复部分漫源失效问题；\n2、优化细节问题。"
    fir_cli(
      api_token: "df347b91ebcfccd894b6b176f410f061", 
      changelog: updateVersionDes
    )
    puts "--- 【Notice】upload fir.im end -------------------------"
  end
end
```

打包成功：

```swift
bundle exec fastlane export_ipa
[✔] 🚀 
[18:34:01]: ------------------------------
[18:34:01]: --- Step: default_platform ---
[18:34:01]: ------------------------------
[18:34:01]: Driving the lane 'ios export_ipa' 🚀
[18:34:01]: -----------------
[18:34:01]: --- Step: gym ---
[18:34:01]: -----------------
[18:34:01]: Resolving Swift Package Manager dependencies...
...
...
...
+--------------------------------------+-----------------------------------------------------+
|                                  Summary for gym 2.205.2                                   |
+--------------------------------------+-----------------------------------------------------+
| clean                                | true                                                |
| output_directory                     | ./fastlane/package                                  |
| scheme                               | JJCComicBook                                        |
| workspace                            | JJCComicBook.xcworkspace                            |
| configuration                        | Release                                             |
| export_method                        | app-store                                           |
| output_name                          | JJCComicBook                                        |
| silent                               | false                                               |
| skip_package_ipa                     | false                                               |
| skip_package_pkg                     | false                                               |
| build_path                           | /Users/mxgx/Library/Developer/Xcode/Archives/2022-  |
|                                      | 05-05                                               |
| result_bundle                        | false                                               |
| buildlog_path                        | ~/Library/Logs/gym                                  |
| destination                          | generic/platform=iOS                                |
| xcodebuild_formatter                 | xcpretty                                            |
| skip_profile_detection               | false                                               |
| xcodebuild_command                   | xcodebuild                                          |
| skip_package_dependencies_resolution | false                                               |
| disable_package_automatic_updates    | false                                               |
| use_system_scm                       | false                                               |
| xcode_path                           | /Applications/Xcode.app                             |
+--------------------------------------+-----------------------------------------------------+
...
...
...
[18:38:30]: Successfully exported and compressed dSYM file
[18:38:30]: Successfully exported and signed the ipa file:
[18:38:30]: /Users/mxgx/Documents/GitHub/JJCComicBook/Code/JJCComicBook/fastlane/package/JJCComicBook.ipa

+------+------------------+-------------+
|           fastlane summary            |
+------+------------------+-------------+
| Step | Action           | Time (in s) |
+------+------------------+-------------+
| 1    | default_platform | 0           |
| 2    | gym              | 269         |
+------+------------------+-------------+

[18:38:30]: fastlane.tools finished successfully 🎉
```

![Fastlane - 打包信息](/images/iOS/2022-05-07-Fastlane-02.png)
![Fastlane - 打包成功标识 01](/images/iOS/2022-05-07-Fastlane-03.png)
![Fastlane - 打包成功标识 02](/images/iOS/2022-05-07-Fastlane-04.png)

### Fastlane Actions

```swift
+----------------------------------+----------------------------------+------------------+
|                               Available fastlane actions                               |
+----------------------------------+----------------------------------+------------------+
| Action                           | Description                      | Author           |
+----------------------------------+----------------------------------+------------------+
| adb                              | Run ADB Actions                  | hjanuschka       |
| adb_devices                      | Get an array of Connected        | hjanuschka       |
|                                  | android device serials           |                  |
| add_extra_platforms              | Modify the default list of       | lacostej         |
|                                  | supported platforms              |                  |
| add_git_tag                      | This will add an annotated git   | Multiple         |
|                                  | tag to the current branch        |                  |
| app_store_build_number           | Returns the current              | hjanuschka       |
|                                  | build_number of either live or   |                  |
|                                  | edit version                     |                  |
| app_store_connect_api_key        | Load the App Store Connect API   | joshdholtz       |
|                                  | token to use in other fastlane   |                  |
|                                  | tools and actions                |                  |
| appaloosa                        | Upload your app to "Appaloosa    | Appaloosa        |
|                                  | Store"                           |                  |
|                                  | (https://www.appaloosa-store.co  |                  |
|                                  | m/ 🔗)                           |                  |
| appetize                         | Upload your app to               | Multiple         |
|                                  | "Appetize.io"                    |                  |
|                                  | (https://appetize.io/ 🔗) to     |                  |
|                                  | stream it in browser             |                  |
| appetize_viewing_url_generator   | Generate an URL for appetize     | KrauseFx         |
|                                  | simulator                        |                  |
| appium                           | Run UI test by Appium with       | yonekawa         |
|                                  | RSpec                            |                  |
| appledoc                         | Generate Apple-like source code  | alexmx           |
|                                  | documentation from the source    |                  |
|                                  | code                             |                  |
| appstore                         | Alias for the                    | KrauseFx         |
|                                  | `upload_to_app_store` action     |                  |
| apteligent                       | Upload dSYM file to "Apteligent  | Mo7amedFouad     |
|                                  | (Crittercism)"                   |                  |
|                                  | (http://www.apteligent.com/ 🔗)  |                  |
| artifactory                      | This action uploads an artifact  | Multiple         |
|                                  | to artifactory                   |                  |
| automatic_code_signing           | Configures Xcode's Codesigning   | Multiple         |
| (DEPRECATED)                     | options                          |                  |
| backup_file                      | This action backs up your file   | gin0606          |
|                                  | to "[path].back"                 |                  |
| backup_xcarchive                 | Save your [zipped] xcarchive     | dral3x           |
|                                  | elsewhere from default path      |                  |
| badge (DEPRECATED)               | Automatically add a badge to     | DanielGri        |
|                                  | your app icon                    |                  |
| build_and_upload_to_appetize     | Generate and upload an ipa file  | KrauseFx         |
|                                  | to appetize.io                   |                  |
| build_android_app                | Alias for the `gradle` action    | Multiple         |
| build_app                        | Easily build and sign your app   | KrauseFx         |
|                                  | (via _gym_)                      |                  |
| build_ios_app                    | Alias for the `build_app`        | KrauseFx         |
|                                  | action but only for iOS          |                  |
| build_mac_app                    | Alias for the `build_app`        | KrauseFx         |
|                                  | action but only for macOS        |                  |
| bundle_install                   | This action runs `bundle         | Multiple         |
|                                  | install` (if available)          |                  |
| capture_android_screenshots      | Automated localized screenshots  | Multiple         |
|                                  | of your Android app (via         |                  |
|                                  | _screengrab_)                    |                  |
| capture_ios_screenshots          | Generate new localized           | KrauseFx         |
|                                  | screenshots on multiple devices  |                  |
|                                  | (via _snapshot_)                 |                  |
| capture_screenshots              | Alias for the                    | KrauseFx         |
|                                  | `capture_ios_screenshots`        |                  |
|                                  | action                           |                  |
| carthage                         | Runs `carthage` for your         | Multiple         |
|                                  | project                          |                  |
| cert                             | Alias for the                    | KrauseFx         |
|                                  | `get_certificates` action        |                  |
| changelog_from_git_commits       | Collect git commit messages      | Multiple         |
|                                  | into a changelog                 |                  |
| chatwork                         | Send a success/error message to  | astronaughts     |
|                                  | "ChatWork"                       |                  |
|                                  | (https://go.chatwork.com/ 🔗)    |                  |
| check_app_store_metadata         | Check your app's metadata        | taquitos         |
|                                  | before you submit your app to    |                  |
|                                  | review (via _precheck_)          |                  |
| clean_build_artifacts            | Deletes files created as result  | lmirosevic       |
|                                  | of running gym, cert, sigh or    |                  |
|                                  | download_dsyms                   |                  |
| clean_cocoapods_cache            | Remove the cache for pods        | alexmx           |
| clear_derived_data               | Deletes the Xcode Derived Data   | KrauseFx         |
| clipboard                        | Copies a given string into the   | Multiple         |
|                                  | clipboard. Works only on macOS   |                  |
| cloc                             | Generates a Code Count that can  | intere           |
|                                  | be read by Jenkins (xml format)  |                  |
| cocoapods                        | Runs `pod install` for the       | Multiple         |
|                                  | project                          |                  |
| commit_github_file               | This will commit a file          | tommeier         |
|                                  | directly on GitHub via the API   |                  |
| commit_version_bump              | Creates a 'Version Bump'         | lmirosevic       |
|                                  | commit. Run after                |                  |
|                                  | `increment_build_number`         |                  |
| copy_artifacts                   | Copy and save your build         | lmirosevic       |
|                                  | artifacts (useful when you use   |                  |
|                                  | reset_git_repo)                  |                  |
| create_app_on_managed_play_stor  | Create Managed Google Play Apps  | janpio           |
| e                                |                                  |                  |
| create_app_online                | Creates the given application    | KrauseFx         |
|                                  | on iTC and the Dev Portal (via   |                  |
|                                  | _produce_)                       |                  |
| create_keychain                  | Create a new Keychain            | gin0606          |
| create_pull_request              | This will create a new pull      | Multiple         |
|                                  | request on GitHub                |                  |
| create_xcframework               | Package multiple build configs   | jgongo           |
|                                  | of a library/framework into a    |                  |
|                                  | single xcframework               |                  |
| danger                           | Runs `danger` for the project    | KrauseFx         |
| debug                            | Print out an overview of the     | KrauseFx         |
|                                  | lane context values              |                  |
| default_platform                 | Defines a default platform to    | KrauseFx         |
|                                  | not have to specify the          |                  |
|                                  | platform                         |                  |
| delete_keychain                  | Delete keychains and remove      | Multiple         |
|                                  | them from the search list        |                  |
| deliver                          | Alias for the                    | KrauseFx         |
|                                  | `upload_to_app_store` action     |                  |
| deploygate                       | Upload a new build to            | Multiple         |
|                                  | "DeployGate"                     |                  |
|                                  | (https://deploygate.com/ 🔗)     |                  |
| dotgpg_environment               | Reads in production secrets set  | simonlevy5       |
|                                  | in a dotgpg file and puts them   |                  |
|                                  | in ENV                           |                  |
| download                         | Download a file from a remote    | KrauseFx         |
|                                  | server (e.g. JSON file)          |                  |
| download_app_privacy_details_fr  | Download App Privacy Details     | igor-makarov     |
| om_app_store                     | from an app in App Store         |                  |
|                                  | Connect                          |                  |
| download_dsyms                   | Download dSYM files from App     | KrauseFx         |
|                                  | Store Connect for Bitcode apps   |                  |
| download_from_play_store         | Download metadata and binaries   | janpio           |
|                                  | from Google Play (via _supply_)  |                  |
| dsym_zip                         | Creates a zipped dSYM in the     | lmirosevic       |
|                                  | project root from the            |                  |
|                                  | .xcarchive                       |                  |
| echo                             | Alias for the `puts` action      | KrauseFx         |
| ensure_bundle_exec               | Raises an exception if not       | rishabhtayal     |
|                                  | using `bundle exec` to run       |                  |
|                                  | fastlane                         |                  |
| ensure_env_vars                  | Raises an exception if the       | revolter         |
|                                  | specified env vars are not set   |                  |
| ensure_git_branch                | Raises an exception if not on a  | Multiple         |
|                                  | specific git branch              |                  |
| ensure_git_status_clean          | Raises an exception if there     | Multiple         |
|                                  | are uncommitted git changes      |                  |
| ensure_no_debug_code             | Ensures the given text is        | KrauseFx         |
|                                  | nowhere in the code base         |                  |
| ensure_xcode_version             | Ensure the right version of      | Multiple         |
|                                  | Xcode is used                    |                  |
| environment_variable             | Sets/gets env vars for           | taquitos         |
|                                  | Fastlane.swift. Don't use in     |                  |
|                                  | ruby, use `ENV[key] = val`       |                  |
| erb                              | Allows to Generate output files  | hjanuschka       |
|                                  | based on ERB templates           |                  |
| fastlane_version                 | Alias for the                    | KrauseFx         |
|                                  | `min_fastlane_version` action    |                  |
| flock                            | Send a message to a "Flock"      | Manav            |
|                                  | (https://flock.com/ 🔗) group    |                  |
| frame_screenshots                | Adds device frames around all    | KrauseFx         |
|                                  | screenshots (via _frameit_)      |                  |
| frameit                          | Alias for the                    | KrauseFx         |
|                                  | `frame_screenshots` action       |                  |
| gcovr                            | Runs test coverage reports for   | dtrenz           |
|                                  | your Xcode project               |                  |
| get_build_number                 | Get the build number of your     | Liquidsoul       |
|                                  | project                          |                  |
| get_build_number_repository      | Get the build number from the    | Multiple         |
|                                  | current repository               |                  |
| get_certificates                 | Create new iOS code signing      | KrauseFx         |
|                                  | certificates (via _cert_)        |                  |
| get_github_release               | This will verify if a given      | Multiple         |
|                                  | release version is available on  |                  |
|                                  | GitHub                           |                  |
| get_info_plist_value             | Returns value from Info.plist    | kohtenko         |
|                                  | of your project as native Ruby   |                  |
|                                  | data structures                  |                  |
| get_ipa_info_plist_value         | Returns a value from Info.plist  | johnboiles       |
|                                  | inside a .ipa file               |                  |
| get_managed_play_store_publishi  | Obtain publishing rights for     | janpio           |
| ng_rights                        | custom apps on Managed Google    |                  |
|                                  | Play Store                       |                  |
| get_provisioning_profile         | Generates a provisioning         | KrauseFx         |
|                                  | profile, saving it in the        |                  |
|                                  | current folder (via _sigh_)      |                  |
| get_push_certificate             | Ensure a valid push profile is   | KrauseFx         |
|                                  | active, creating a new one if    |                  |
|                                  | needed (via _pem_)               |                  |
| get_version_number               | Get the version number of your   | Multiple         |
|                                  | project                          |                  |
| git_add                          | Directly add the given file or   | Multiple         |
|                                  | all files                        |                  |
| git_branch                       | Returns the name of the current  | KrauseFx         |
|                                  | git branch, possibly as managed  |                  |
|                                  | by CI ENV vars                   |                  |
| git_commit                       | Directly commit the given file   | KrauseFx         |
|                                  | with the given message           |                  |
| git_pull                         | Executes a simple git pull       | Multiple         |
|                                  | command                          |                  |
| git_remote_branch                | Returns the name of the current  | SeanMcNeil       |
|                                  | git remote default branch        |                  |
| git_submodule_update             | Executes a git submodule update  | braunico         |
|                                  | command                          |                  |
| git_tag_exists                   | Checks if the git tag with the   | antondomashnev   |
|                                  | given name exists in the         |                  |
|                                  | current repo                     |                  |
| github_api                       | Call a GitHub API endpoint and   | tommeier         |
|                                  | get the resulting JSON response  |                  |
| google_play_track_release_names  | Retrieves release names for a    | raldred          |
|                                  | Google Play track                |                  |
| google_play_track_version_codes  | Retrieves version codes for a    | panthomakos      |
|                                  | Google Play track                |                  |
| gradle                           | All gradle related actions,      | Multiple         |
|                                  | including building and testing   |                  |
|                                  | your Android app                 |                  |
| gym                              | Alias for the `build_app`        | KrauseFx         |
|                                  | action                           |                  |
| hg_add_tag                       | This will add a hg tag to the    | sjrmanning       |
|                                  | current branch                   |                  |
| hg_commit_version_bump           | This will commit a version bump  | sjrmanning       |
|                                  | to the hg repo                   |                  |
| hg_ensure_clean_status           | Raises an exception if there     | sjrmanning       |
|                                  | are uncommitted hg changes       |                  |
| hg_push                          | This will push changes to the    | sjrmanning       |
|                                  | remote hg repository             |                  |
| hipchat                          | Send a error/success message to  | jingx23          |
|                                  | "HipChat"                        |                  |
|                                  | (https://www.hipchat.com/ 🔗)    |                  |
| hockey (DEPRECATED)              | Refer to "App Center"            | Multiple         |
|                                  | (https://github.com/Microsoft/f  |                  |
|                                  | astlane-plugin-appcenter/ 🔗)    |                  |
| ifttt                            | Connect to the "IFTTT Maker      | vpolouchkine     |
|                                  | Channel"                         |                  |
|                                  | (https://ifttt.com/maker 🔗)     |                  |
| import                           | Import another Fastfile to use   | KrauseFx         |
|                                  | its lanes                        |                  |
| import_certificate               | Import certificate from          | gin0606          |
|                                  | inputfile into a keychain        |                  |
| import_from_git                  | Import another Fastfile from a   | Multiple         |
|                                  | remote git repository to use     |                  |
|                                  | its lanes                        |                  |
| increment_build_number           | Increment the build number of    | KrauseFx         |
|                                  | your project                     |                  |
| increment_version_number         | Increment the version number of  | serluca          |
|                                  | your project                     |                  |
| install_on_device                | Installs an .ipa file on a       | hjanuschka       |
|                                  | connected iOS-device via usb or  |                  |
|                                  | wifi                             |                  |
| install_provisioning_profile     | Install provisioning profile     | SofteqDG         |
|                                  | from path                        |                  |
| install_xcode_plugin             | Install an Xcode plugin for the  | Multiple         |
|                                  | current user                     |                  |
| installr                         | Upload a new build to            | scottrhoyt       |
|                                  | "Installr"                       |                  |
|                                  | (http://installrapp.com/ 🔗)     |                  |
| ipa (DEPRECATED)                 | Easily build and sign your app   | joshdholtz       |
|                                  | using shenzhen                   |                  |
| is_ci                            | Is the current run being         | KrauseFx         |
|                                  | executed on a CI system, like    |                  |
|                                  | Jenkins or Travis                |                  |
| jazzy                            | Generate docs using Jazzy        | KrauseFx         |
| jira                             | Leave a comment on a Jira        | Multiple         |
|                                  | ticket                           |                  |
| lane_context                     | Access lane context values       | KrauseFx         |
| last_git_commit                  | Return last git commit hash,     | ngutman          |
|                                  | abbreviated commit hash, commit  |                  |
|                                  | message and author               |                  |
| last_git_tag                     | Get the most recent git tag      | Multiple         |
| latest_testflight_build_number   | Fetches most recent build        | daveanderson     |
|                                  | number from TestFlight           |                  |
| lcov                             | Generates coverage data using    | thiagolioy       |
|                                  | lcov                             |                  |
| mailgun                          | Send a success/error message to  | thiagolioy       |
|                                  | an email group                   |                  |
| make_changelog_from_jenkins      | Generate a changelog using the   | mandrizzle       |
|                                  | Changes section from the         |                  |
|                                  | current Jenkins build            |                  |
| match                            | Alias for the                    | KrauseFx         |
|                                  | `sync_code_signing` action       |                  |
| match_nuke                       | Easily nuke your certificate     | crazymanish      |
|                                  | and provisioning profiles (via   |                  |
|                                  | _match_)                         |                  |
| min_fastlane_version             | Verifies the minimum fastlane    | KrauseFx         |
|                                  | version required                 |                  |
| modify_services                  | Modifies the services of the     | bhimsenpadalkar  |
|                                  | app created on Developer Portal  |                  |
| nexus_upload                     | Upload a file to "Sonatype       | Multiple         |
|                                  | Nexus platform"                  |                  |
|                                  | (https://www.sonatype.com 🔗)    |                  |
| notarize                         | Notarizes a macOS app            | zeplin           |
| notification                     | Display a macOS notification     | Multiple         |
|                                  | with custom message and title    |                  |
| notify (DEPRECATED)              | Shows a macOS notification -     | Multiple         |
|                                  | use `notification` instead       |                  |
| number_of_commits                | Return the number of commits in  | Multiple         |
|                                  | current git branch               |                  |
| oclint                           | Lints implementation files with  | HeEAaD           |
|                                  | OCLint                           |                  |
| onesignal                        | Create or update a new           | Multiple         |
|                                  | "OneSignal"                      |                  |
|                                  | (https://onesignal.com/ 🔗)      |                  |
|                                  | application                      |                  |
| opt_out_crash_reporting          | This will prevent reports from   | Multiple         |
| (DEPRECATED)                     | being uploaded when _fastlane_   |                  |
|                                  | crashes                          |                  |
| opt_out_usage                    | This will stop uploading the     | KrauseFx         |
|                                  | information which actions were   |                  |
|                                  | run                              |                  |
| pem                              | Alias for the                    | KrauseFx         |
|                                  | `get_push_certificate` action    |                  |
| pilot                            | Alias for the                    | KrauseFx         |
|                                  | `upload_to_testflight` action    |                  |
| pod_lib_lint                     | Pod lib lint                     | thierryxing      |
| pod_push                         | Push a Podspec to Trunk or a     | squarefrog       |
|                                  | private repository               |                  |
| podio_item                       | Creates or updates an item       | Multiple         |
|                                  | within your Podio app            |                  |
| precheck                         | Alias for the                    | taquitos         |
|                                  | `check_app_store_metadata`       |                  |
|                                  | action                           |                  |
| println                          | Alias for the `puts` action      | KrauseFx         |
| produce                          | Alias for the                    | KrauseFx         |
|                                  | `create_app_online` action       |                  |
| prompt                           | Ask the user for a value or for  | KrauseFx         |
|                                  | confirmation                     |                  |
| push_git_tags                    | Push local tags to the remote -  | vittoriom        |
|                                  | this will only push tags         |                  |
| push_to_git_remote               | Push local changes to the        | lmirosevic       |
|                                  | remote branch                    |                  |
| puts                             | Prints out the given text        | KrauseFx         |
| read_podspec                     | Loads a CocoaPods spec as JSON   | czechboy0        |
| recreate_schemes                 | Recreate not shared Xcode        | jerolimov        |
|                                  | project schemes                  |                  |
| register_device                  | Registers a new device to the    | pvinis           |
|                                  | Apple Dev Portal                 |                  |
| register_devices                 | Registers new devices to the     | lmirosevic       |
|                                  | Apple Dev Portal                 |                  |
| reset_git_repo                   | Resets git repo to a clean       | lmirosevic       |
|                                  | state by discarding uncommitted  |                  |
|                                  | changes                          |                  |
| reset_simulator_contents         | Shutdown and reset running       | danramteke       |
|                                  | simulators                       |                  |
| resign                           | Codesign an existing ipa file    | lmirosevic       |
| restore_file                     | This action restore your file    | gin0606          |
|                                  | that was backuped with the       |                  |
|                                  | `backup_file` action             |                  |
| rocket                           | Outputs ascii-art for a rocket   | Multiple         |
|                                  | 🚀                               |                  |
| rsync                            | Rsync files from :source to      | hjanuschka       |
|                                  | :destination                     |                  |
| ruby_version                     | Verifies the minimum ruby        | sebastianvarela  |
|                                  | version required                 |                  |
| run_tests                        | Easily run tests of your iOS     | KrauseFx         |
|                                  | app (via _scan_)                 |                  |
| s3 (DEPRECATED)                  | Generates a plist file and       | joshdholtz       |
|                                  | uploads all to AWS S3            |                  |
| say                              | This action speaks the given     | KrauseFx         |
|                                  | text out loud                    |                  |
| scan                             | Alias for the `run_tests`        | KrauseFx         |
|                                  | action                           |                  |
| scp                              | Transfer files via SCP           | hjanuschka       |
| screengrab                       | Alias for the                    | Multiple         |
|                                  | `capture_android_screenshots`    |                  |
|                                  | action                           |                  |
| set_build_number_repository      | Set the build number from the    | Multiple         |
|                                  | current repository               |                  |
| set_changelog                    | Set the changelog for all        | KrauseFx         |
|                                  | languages on App Store Connect   |                  |
| set_github_release               | This will create a new release   | Multiple         |
|                                  | on GitHub and upload assets for  |                  |
|                                  | it                               |                  |
| set_info_plist_value             | Sets value to Info.plist of      | Multiple         |
|                                  | your project as native Ruby      |                  |
|                                  | data structures                  |                  |
| set_pod_key                      | Sets a value for a key with      | marcelofabri     |
|                                  | cocoapods-keys                   |                  |
| setup_ci                         | Setup the keychain and match to  | Multiple         |
|                                  | work with CI                     |                  |
| setup_circle_ci                  | Setup the keychain and match to  | dantoml          |
|                                  | work with CircleCI               |                  |
| setup_jenkins                    | Setup xcodebuild, gym and scan   | bartoszj         |
|                                  | for easier Jenkins integration   |                  |
| setup_travis                     | Setup the keychain and match to  | KrauseFx         |
|                                  | work with Travis CI              |                  |
| sh                               | Runs a shell command             | KrauseFx         |
| sigh                             | Alias for the                    | KrauseFx         |
|                                  | `get_provisioning_profile`       |                  |
|                                  | action                           |                  |
| skip_docs                        | Skip the creation of the         | KrauseFx         |
|                                  | fastlane/README.md file when     |                  |
|                                  | running fastlane                 |                  |
| slack                            | Send a success/error message to  | KrauseFx         |
|                                  | your "Slack" (https://slack.com  |                  |
|                                  | 🔗) group                        |                  |
| slather                          | Use slather to generate a code   | mattdelves       |
|                                  | coverage report                  |                  |
| snapshot                         | Alias for the                    | KrauseFx         |
|                                  | `capture_ios_screenshots`        |                  |
|                                  | action                           |                  |
| sonar                            | Invokes sonar-scanner to         | c_gretzki        |
|                                  | programmatically run SonarQube   |                  |
|                                  | analysis                         |                  |
| sourcedocs                       | Generate docs using SourceDocs   | Kukurijek        |
| spaceship_logs                   | Find, print, and copy Spaceship  | joshdholtz       |
|                                  | logs                             |                  |
| spaceship_stats                  | Print out Spaceship stats from   | joshdholtz       |
|                                  | this session (number of request  |                  |
|                                  | to each domain)                  |                  |
| splunkmint                       | Upload dSYM file to "Splunk      | xfreebird        |
|                                  | MINT" (https://mint.splunk.com/  |                  |
|                                  | 🔗)                              |                  |
| spm                              | Runs Swift Package Manager on    | Multiple         |
|                                  | your project                     |                  |
| ssh                              | Allows remote command execution  | hjanuschka       |
|                                  | using ssh                        |                  |
| supply                           | Alias for the                    | KrauseFx         |
|                                  | `upload_to_play_store` action    |                  |
| swiftlint                        | Run swift code validation using  | KrauseFx         |
|                                  | SwiftLint                        |                  |
| sync_code_signing                | Easily sync your certificates    | KrauseFx         |
|                                  | and profiles across your team    |                  |
|                                  | (via _match_)                    |                  |
| team_id                          | Specify the Team ID you want to  | KrauseFx         |
|                                  | use for the Apple Developer      |                  |
|                                  | Portal                           |                  |
| team_name                        | Set a team to use by its name    | KrauseFx         |
| testfairy                        | Upload a new build to            | Multiple         |
|                                  | "TestFairy"                      |                  |
|                                  | (https://www.testfairy.com/ 🔗)  |                  |
| testflight                       | Alias for the                    | KrauseFx         |
|                                  | `upload_to_testflight` action    |                  |
| trainer                          | Convert the Xcode plist log to   | KrauseFx         |
|                                  | a JUnit report                   |                  |
| tryouts                          | Upload a new build to "Tryouts"  | alicertel        |
|                                  | (https://tryouts.io/ 🔗)         |                  |
| twitter                          | Post a tweet on "Twitter.com"    | hjanuschka       |
|                                  | (https://twitter.com 🔗)         |                  |
| typetalk                         | Post a message to "Typetalk"     | Nulab Inc.       |
|                                  | (https://www.typetalk.com/ 🔗)   |                  |
| unlock_keychain                  | Unlock a keychain                | xfreebird        |
| update_app_group_identifiers     | This action changes the app      | mathiasAichinger |
|                                  | group identifiers in the         |                  |
|                                  | entitlements file                |                  |
| update_app_identifier            | Update the project's bundle      | Multiple         |
|                                  | identifier                       |                  |
| update_code_signing_settings     | Configures Xcode's Codesigning   | Multiple         |
|                                  | options                          |                  |
| update_fastlane                  | Makes sure fastlane-tools are    | Multiple         |
|                                  | up-to-date when running          |                  |
|                                  | fastlane                         |                  |
| update_icloud_container_identif  | This action changes the iCloud   | JamesKuang       |
| iers                             | container identifiers in the     |                  |
|                                  | entitlements file                |                  |
| update_info_plist                | Update a Info.plist file with    | tobiasstrebitzer |
|                                  | bundle identifier and display    |                  |
|                                  | name                             |                  |
| update_keychain_access_groups    | This action changes the          | yutae            |
|                                  | keychain access groups in the    |                  |
|                                  | entitlements file                |                  |
| update_plist                     | Update a plist file              | Multiple         |
| update_project_code_signing      | Updated code signing settings    | KrauseFx         |
| (DEPRECATED)                     | from 'Automatic' to a specific   |                  |
|                                  | profile                          |                  |
| update_project_provisioning      | Update projects code signing     | Multiple         |
|                                  | settings from your provisioning  |                  |
|                                  | profile                          |                  |
| update_project_team              | Update Xcode Development Team    | lgaches          |
|                                  | ID                               |                  |
| update_urban_airship_configurat  | Set "Urban Airship"              | kcharwood        |
| ion                              | (https://www.urbanairship.com/   |                  |
|                                  | 🔗) plist configuration values   |                  |
| update_url_schemes               | Updates the URL schemes in the   | kmikael          |
|                                  | given Info.plist                 |                  |
| upload_app_privacy_details_to_a  | Upload App Privacy Details for   | joshdholtz       |
| pp_store                         | an app in App Store Connect      |                  |
| upload_symbols_to_crashlytics    | Upload dSYM symbolication files  | KrauseFx         |
|                                  | to Crashlytics                   |                  |
| upload_symbols_to_sentry         | Upload dSYM symbolication files  | joshdholtz       |
| (DEPRECATED)                     | to Sentry                        |                  |
| upload_to_app_store              | Upload metadata and binary to    | KrauseFx         |
|                                  | App Store Connect (via           |                  |
|                                  | _deliver_)                       |                  |
| upload_to_play_store             | Upload metadata, screenshots     | KrauseFx         |
|                                  | and binaries to Google Play      |                  |
|                                  | (via _supply_)                   |                  |
| upload_to_play_store_internal_a  | Upload binaries to Google Play   | andrewhavens     |
| pp_sharing                       | Internal App Sharing (via        |                  |
|                                  | _supply_)                        |                  |
| upload_to_testflight             | Upload new binary to App Store   | KrauseFx         |
|                                  | Connect for TestFlight beta      |                  |
|                                  | testing (via _pilot_)            |                  |
| validate_play_store_json_key     | Validate that the Google Play    | janpio           |
|                                  | Store `json_key` works           |                  |
| verify_build                     | Able to verify various settings  | CodeReaper       |
|                                  | in ipa file                      |                  |
| verify_pod_keys                  | Verifies all keys referenced     | ashfurrow        |
|                                  | from the Podfile are non-empty   |                  |
| verify_xcode                     | Verifies that the Xcode          | KrauseFx         |
|                                  | installation is properly signed  |                  |
|                                  | by Apple                         |                  |
| version_bump_podspec             | Increment or set the version in  | Multiple         |
|                                  | a podspec file                   |                  |
| version_get_podspec              | Receive the version number from  | Multiple         |
|                                  | a podspec file                   |                  |
| xcarchive                        | Archives the project using       | dtrenz           |
|                                  | `xcodebuild`                     |                  |
| xcbuild                          | Builds the project using         | dtrenz           |
|                                  | `xcodebuild`                     |                  |
| xcclean                          | Cleans the project using         | dtrenz           |
|                                  | `xcodebuild`                     |                  |
| xcexport                         | Exports the project using        | dtrenz           |
|                                  | `xcodebuild`                     |                  |
| xcode_install                    | Make sure a certain version of   | Krausefx         |
|                                  | Xcode is installed               |                  |
| xcode_select                     | Change the xcode-path to use.    | dtrenz           |
|                                  | Useful for beta versions of      |                  |
|                                  | Xcode                            |                  |
| xcode_server_get_assets          | Downloads Xcode Bot assets like  | czechboy0        |
|                                  | the `.xcarchive` and logs        |                  |
| xcodebuild                       | Use the `xcodebuild` command to  | dtrenz           |
|                                  | build and sign your app          |                  |
| xcov                             | Nice code coverage reports       | nakiostudio      |
|                                  | without hassle                   |                  |
| xctest                           | Runs tests on the given          | dtrenz           |
|                                  | simulator                        |                  |
| xctool                           | Run tests using xctool           | KrauseFx         |
| xcversion                        | Select an Xcode to use by        | Multiple         |
|                                  | version specifier                |                  |
| zip                              | Compress a file or folder to a   | KrauseFx         |
|                                  | zip                              |                  |
+----------------------------------+----------------------------------+------------------+
```

### Fastlane 发布 TestFlight

- [参考资料：简书 - iOS(Swift) fastlane集成,发送 testflight(二)](https://www.jianshu.com/p/e60b1d3e7c69)
- [参考资料：掘金 - iOS+Fastlane自动打包发布到TestFlight](https://juejin.cn/post/7021167923632799758)

`fastlane` 自动化打包发布到 `TestFlight` 需要借助到 `AppStore Connect` 中的 **`密钥`** ，所以需要提前先申请一下：
- 登录 [AppStore Connect](https://appstoreconnect.apple.com)；
- 点击 `Users and Access（用户和访问）` -> `Keys（密钥）` -> `App Store Connect API`；
- 点击 `请求访问权限`，然后执行操作步骤申请 `Key`；
- `生产 API 密钥` 时需要注意，生成的密钥结果文件，**`只能下载一次`** ，所以需要注意保存文件。
- 需要用到 `Issuer ID`、`Key ID`，以及对应的 `密钥文件（.p8 文件）`。

![Fastlane - 申请密钥 01](/images/iOS/2022-05-07-Fastlane-05.png)
![Fastlane - 申请密钥 02](/images/iOS/2022-05-07-Fastlane-06.png)

```swift
/// Fastfile
# update_fastlane
default_platform(:ios)
platform :ios do 
  desc "Push a new ad-hoc build to TestFlight、pgyer、fir.im."
  lane :export_ipa do |option|
    puts "【公告】打包开始 -------------------------"
    gym(
      clean: true,
      output_directory: "./fastlane/package",
      scheme: "JJCComicBook",
      workspace: "JJCComicBook.xcworkspace",
      configuration: "Release",
      export_method: "app-store",
      export_options: {iCloudContainerEnvironment: "Production"},
      export_xcargs: "-allowProvisioningUpdates"
    )
    puts "【公告】打包结束 -------------------------"

    # mac上的通知弹窗，通知打包完毕
    notification(app_icon: "./fastlane/icon.png", title: "苜蓿漫画", subtitle: "打包成功，已导出安装包", message: "准备发布中……")

    puts "【公告】上传 TestFlight 开始 -------------------------"
    api_key = app_store_connect_api_key(
      key_id: "7******S", 
      issuer_id: "53*********************68",
      key_filepath: "./fastlane/JJCComicBook_API_Key_Developer.p8",
      duration: 1200,
      in_house: false
    )
    upload_to_testflight(
      api_key: api_key,
      skip_waiting_for_build_processing: true,
      # username: "开发者账户邮箱",
      # app_identifier: "Bundle ID",
      ipa: "./fastlane/package/JJCComicBook.ipa",
      skip_submission:true
    )
    puts "【公告】上传 TestFlight 结束 -------------------------"
  end
end
```

另外在配置中 `key_id` 和 `username、app_identifier` 不同同时共存，只保留其中一方就行了，否则会报错：

```swift
[!] Unresolved conflict between options: 'api_key' and 'username'
```

再者，上传到 `TestFlight` 常常会遇到 `缺少出口合规证明` 的配置选项，每次发布版本都需要手动选择一次，比较麻烦，解决办法：

```swift
/// 只需要在项目工程的 info.plist 文件中，添加 App Uses Non-Exempt Encryption 设置为 NO 即可
<key>ITSAppUsesNonExemptEncryption</key>
    <false/>
```

![Fastlane - 上传 TestFlight 成功 01](/images/iOS/2022-05-07-Fastlane-07.png)

### Fastlane 发布蒲公英
#### Fastlane + 蒲公英

- [Fastlane - 官网](https://docs.fastlane.tools/)
- [Fastlane - plugins](https://docs.fastlane.tools/plugins/using-plugins/)
- [蒲公英官网](https://www.pgyer.com/)

```swift
/// 查询 plugins 指令
fastlane search_plugins xxx
/// 添加安装 plugin 指令，建议前面加 sudo，否则偶尔会因为权限问题报错
fastlane add_plugin xxx
/// 安装 plugins，前提是创建的有 Pluginfile 的 Gemfile 文件，里面添加的有对应的 plugin
fastlane install_plugins
/// 更新 plugins
fastlane update_plugins
```

`Fastlane` 需要通过 `pgyer` 指令才能处理上传 `蒲公英` 相关的任务，而 `Fastlane` 官方实际上并没有提供该指令，这是通过 `plugins` 扩展插件实现的，是 `蒲公英` 官方提供的 `CI`。

```swift
/// 通过该指令添加对 pgyer 的支持
sudo fastlane add_plugin pgyer
```

执行完该指令后，在 `./fastlane` 文件夹下会多出一个 `Pluginfile` 的 `Gemfile` 文件，用于管理 `plugins` 扩展的。

```swift
/// Fastfile
# update_fastlane
default_platform(:ios)
platform :ios do 
  desc "Push a new ad-hoc build to TestFlight、pgyer、fir.im."
  lane :export_ipa do |option|
    puts "【公告】打包开始 -------------------------"
    gym(
      clean: true,
      output_directory: "./fastlane/package",
      scheme: "JJCComicBook",
      workspace: "JJCComicBook.xcworkspace",
      configuration: "Release",
      export_method: "app-store",
      export_options: {iCloudContainerEnvironment: "Production"},
      export_xcargs: "-allowProvisioningUpdates"
    )
    puts "【公告】打包结束 -------------------------"

    # mac上的通知弹窗，通知打包完毕
    notification(app_icon: "./fastlane/icon.png", title: "苜蓿漫画", subtitle: "打包成功，已导出安装包", message: "准备发布中……")

    updateVersionDes = "苜蓿苜蓿_v2.0.4(2)\n1、修复部分漫源失效问题；\n2、优化细节问题。"

    puts "【公告】上传蒲公英分发平台开始 -------------------------"
    # 上传到蒲公英发布平台
    pgyer(
      api_key: "ef**********************f8",
      user_key: "80**********************c5",
      update_description: updateVersionDes
    )
    puts "【公告】上传蒲公英分发平台结束 -------------------------"
  end
end

```

#### Fastlane + 蒲公英 + 钉钉机器人 + Webhook URL

- [蒲公英官网](https://www.pgyer.com/)
- [参考链接：掘金 - iOS+Fastlane自动打包发布测试、消息通知，完美结合！](https://juejin.cn/post/7008553785672859656)

需要通过 `Webhook URL` 进行关联自动发布，蒲公英官方现在支持四种方式的 `Webhook URL`，分别是 `企业微信、飞书、钉钉、其他` 四种情况。

首先需要在钉钉（version_v5.1.39）群组的 `群设置 -> 智能群助手 -> 添加机器人 -> 自定义（通过 Webhook 接入自定义服务）` 添加一个群组机器人，在 `自定义关键词` 中添加一个关键词，保证可以在每次发布在蒲公英的应用版本 `更新内容` 中都会包含的关键词即可。

其次在蒲公英官网通过 `控制台 -> 某个应用 -> 设置 -> Webhook 设置`，将通过钉钉获取到的机器人的 `Webhook URL` 链接添加到该设置中对应的 `URL` 一栏即可。

此后每次发布新版本时，只需要在 `更新内容` 中包含有对应 `关键字` 即可实现自动消息推送，免去了每次需要手动添加消息发布到对应的钉钉群中。

### Fastlane 发布 Fir.im 
#### Fastlane + Fir（官方版）

- [Fir.im - 官网](https://www.betaqr.com/)
- [Fir.im - 关于 fir.im fastlane 插件的一些说明](https://blog.betaqr.com/guan-yu-fastlane-cha-jian-wen-ti/)
- [Firim 插件（非官方）](https://github.com/whlsxl/firim)
- [Firim 插件（非官方）- fastlane](https://github.com/whlsxl/firim/tree/master/fastlane-plugin-firim)
- [参考资料：Permission denied @ rb_sysopen - /Library/Ruby/Gems/2.3.0/cache/rack-2.0.4.gem](https://www.jianshu.com/p/64cfc0d78fe8)

`Fir.im` 同 `蒲公英` 一样，都是常见的 App 分发平台。

同 `蒲公英` 一样，都需要额外增加 `plugin` 才可以：

```swift
/// 执行安装 fir 插件
fastlane add_plugin fir_cli
/// 如果上面出现报错，则使用下面指令
sudo fastlane add_plugin fir_cli
/// 如果上面出现报错，则使用下面指令
sudo fastlane add_plugin -n /usr/local/bin/ fir_cli
```

紧接着还需要通过 `gem` 安装自动上传到 `fir` 相关的 `CI`：

```swift
/// 安装 fir 自动上传的 CI
gem install fir-cli
/// 如果上面指令报错，则使用下面指令
sudo gem install fir-cli
/// 如果上面指令报错，则使用下面指令
sudo gem install -n /usr/local/bin fir-cli
```

另外，在使用 `fir.im` 的时候，配置的参数是 `firim_api_token`，并非是 `应用 ID`，`firim_api_token` 通过点击 `个人账户 -> API Token（在个人资料、发票信息下面）`。

对应的 `Fastfile` 文件配置：

```swift
/// Fastfile
# update_fastlane
default_platform(:ios)
platform :ios do 
  desc "Push a new ad-hoc build to TestFlight、pgyer、fir.im."
  lane :export_ipa do |option|
    puts "【公告】打包开始 -------------------------"
    gym(
      clean: true,
      output_directory: "./fastlane/package",
      scheme: "JJCComicBook",
      workspace: "JJCComicBook.xcworkspace",
      configuration: "Release",
      export_method: "app-store",
      export_options: {iCloudContainerEnvironment: "Production"},
      export_xcargs: "-allowProvisioningUpdates"
    )
    puts "【公告】打包结束 -------------------------"

    # mac上的通知弹窗，通知打包完毕
    notification(app_icon: "./fastlane/icon.png", title: "苜蓿漫画", subtitle: "打包成功，已导出安装包", message: "准备发布中……")

    puts "【公告】上传 fir.im 分发平台开始 -------------------------"
    # 上传到 fir.im 发布平台
    fir_cli(
      api_token: "df****************61", 
      changelog: "测试 changelog"
    )
    puts "【公告】上传 fir.im 分发平台结束 -------------------------"
  end
end

```

**Webhook 配置：**

在 `应用 -> 集成 -> 消息推送 -> Custom` 配置。

```swift
/// fir_cli 可用参数：
+-----------------+-----------------+-----------------+---------+
|                        fir_cli Options                        |
+-----------------+-----------------+-----------------+---------+
| Key             | Description     | Env Var(s)      | Default |
+-----------------+-----------------+-----------------+---------+
| api_token       | A description   | FIR_CLI_API_TO  |         |
|                 | of your option  | KEN             |         |
| specify_file_p  | FILE APP PATH   | FIR_SPECIFY_FI  |         |
| ath             |                 | LE_PATH         |         |
| short           | fir short       | FIR_APP_SHORT   |         |
| force_pin_hist  | pin this        | FIR_APP_FORCE_  | false   |
| ory             | release to      | PIN_HISTORY     |         |
|                 | download page   |                 |         |
| skip_update_ic  | skip upload     | FIR_APP_SKIP_U  | false   |
| on              | icon            | PDATE_ICON      |         |
| specify_icon_f  | APP ICON FILE   | FIR_SPECIFY_IC  |         |
| ile             | PATH            | ON_FILE_PATH    |         |
| changelog       | changelog path  | FIR_APP_CHANGE  |         |
|                 | or content      | LOG             |         |
| open            | true/false if   | FIR_APP_OPEN    | true    |
|                 | open for        |                 |         |
|                 | everyone        |                 |         |
| password        | Set password    | FIR_APP_PASSWO  |         |
|                 | for app         | RD              |         |
| switch_to_qini  | switch to       | FIR_SWITCH_TO_  | false   |
| u               | qiniu upload    | QINIU           |         |
| need_release_i  | would build     | FIR_NEED_RELEA  | false   |
| d               | download url    | SE_ID           |         |
|                 | with release    |                 |         |
|                 | id              |                 |         |
| dingtalk_acces  | dingtalk_acces  | FIR_DINGTALK_A  |         |
| s_token         | s_token         | CCESS_TOKEN     |         |
| dingtalk_custo  | dingtalk        | FIR_DINGTALK_C  |         |
| m_message       | custom message  | USTOM_MESSAGE   |         |
| dingtalk_at_ph  | dingtalk at     | FIR_DINGTALK_A  |         |
| ones            | phones, split   | T_PHONES        |         |
|                 | with ','        |                 |         |
| dingtalk_at_al  | dingtalk at     | FIR_DINGTALK_A  |         |
| l               | all people      | T_ALL           |         |
| dingtalk_secre  | Dingtalk        | FIR_DINGTALK_S  |         |
| t               | secret code     | ECRET           |         |
|                 | (eg: SECxxxxx)  |                 |         |
| feishu_access_  | feishu_access_  | FIR_FEISHU_ACC  |         |
| token           | token           | ESS_TOKEN       |         |
| feishu_custom_  | feishu custom   | FIR_FEISHU_CUS  |         |
| message         | message         | TOM_MESSAGE     |         |
| wxwork_access_  | wechat work     | FIR_WXWORK_ACC  |         |
| token           | webhook         | ESS_TOKEN       |         |
|                 | access_token    |                 |         |
| wxwork_pic_url  | wechat work     | FIR_WXWORK_PIC  |         |
|                 | webhook pic     | _URL            |         |
|                 | url             |                 |         |
| wxwork_custom_  | wechat work     | FIR_WXWORK_CUS  |         |
| message         | custom message  | TOM_MESSAGE     |         |
+-----------------+-----------------+-----------------+---------+
```

#### Fastlane + Firim（非官方版）

- [Firim 插件（非官方）](https://github.com/whlsxl/firim)
- [Firim 插件（非官方）- fastlane](https://github.com/whlsxl/firim/tree/master/fastlane-plugin-firim)

```swift
/// 添加 plugin 插件
fastlane add_plugin firim
/// 如果上面出现报错，则使用下面指令
sudo fastlane add_plugin firim
/// 如果上面出现报错，则使用下面指令
sudo fastlane add_plugin -n /usr/local/bin/ firim

/// 安装自动上传 fir 插件
gem install fir-cli
/// 如果上面指令报错，则使用下面指令
sudo gem install fir-cli
/// 如果上面指令报错，则使用下面指令
sudo gem install -n /usr/local/bin fir-cli

/// 对应 Fastfile 配置
firim(firim_api_token: "xxxxxxx")
```

### 常见错误
#### 报错：Your Gemfile lists the gem fastlane-plugin-pgyer (>= 0) more than once.

当执行 `bundle install` 或 `bundle update` 时出现如下报错：

```swift
Your Gemfile lists the gem fastlane-plugin-pgyer (>= 0) more than once.
You should probably keep only one of them.
Remove any duplicate entries and specify the gem only once.
While it's not a problem now, it could cause errors if you change the version of one of them later.
```

需要检查一下 `Pluginfile` 文件，是否里面添加了多个：

```swift
gem 'fastlane-plugin-pgyer'
```

删除多余的，重新执行指令即可。

#### 报错：zsh: command not found: fastlane

如果初始化 `fastlane init` 时报该错误，则使用如下指令：

```swift
/// 首先测试：
sudo gem install fastlane
/// 如果上面指令不行，用这个
sudo gem install -n /usr/local/bin fastlane
```

#### 报错：sh: xcpretty: command not found

如果在打包过程中包该错误，则使用如下指令：

```swift
sudo gem install xcpretty -n/usr/local/bin
```

#### 报错：error: exportArchive: exportOptionsPlist error for key "iCloudContainerEnvironment": expected one of {Development, Production}, but no value was provided

如果出现了如下报错引起了打包失败，则是因为项目工程中使用了 `iCloud` 云存储功能，需要进行特殊配置，配置如下：

```swift
/// 项目工程中引入 iCloud 时使用，可选参数有 Development、Production
export_options: {iCloudContainerEnvironment: "Production"},
export_xcargs: "-allowProvisioningUpdates"
```

```swift
error: exportArchive: exportOptionsPlist error for key "iCloudContainerEnvironment": expected one of {Development, Production}, but no value was provided

Error Domain=IDEFoundationErrorDomain Code=1 "exportOptionsPlist error for key "iCloudContainerEnvironment": expected one of {Development, Production}, but no value was provided" UserInfo={NSLocalizedDescription=exportOptionsPlist error for key "iCloudContainerEnvironment": expected one of {Development, Production}, but no value was provided}
```

#### 报错：The call to the iTMSTransporter completed with a non-zero exit status: 1. This indicates a failure.

- [参考资料：Stackoverflow - iTunes Transporter error: Could not resolve module: com.apple.transporter.starter（有效）](https://stackoverflow.com/questions/70950473/itunes-transporter-error-could-not-resolve-module-com-apple-transporter-starte)
- [参考资料：Apple Developer - Transporter error after home folder renaming（有效）](https://developer.apple.com/forums/thread/129378?answerId=419847022#419847022)
- [参考资料：Stackoverflow - Fastlane upload_to_testflight The call to the iTMSTransporter completed with a non-zero exit status: 1. This indicates a failure（无效）](https://stackoverflow.com/questions/66059470/fastlane-upload-to-testflight-the-call-to-the-itmstransporter-completed-with-a-n)
- [参考资料：Stackoverflow - Fabric Fastlane Pilot Upload iTMSTransporter failure（无效）](https://stackoverflow.com/questions/45189547/fabric-fastlane-pilot-upload-itmstransporter-failure)

如果上传 `TestFlight` 时出现如下报错：

```swift
[10:01:37]: This might take a few minutes. Please don't interrupt the script.
[10:01:44]: [iTMSTransporter] 	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
[10:01:44]: [iTMSTransporter] 	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)
[10:01:44]: [iTMSTransporter] 	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)
[10:01:44]: [iTMSTransporter] 	at java.base/java.lang.reflect.Method.invoke(Unknown Source)
[10:01:44]: [iTMSTransporter] 	at com.apple.transporter.bootstrap.BootstrapperPhase1.bootstrap(BootstrapperPhase1.java:107)
[10:01:44]: [iTMSTransporter] 	at com.apple.transporter.bootstrap.BootstrapperPhase1.bootstrap(BootstrapperPhase1.java:78)
[10:01:44]: [iTMSTransporter] 	at com.apple.transporter.launcher.Launcher.launchBootstrapper(Launcher.java:37)
[10:01:44]: [iTMSTransporter] 	... 6 more
[10:01:44]: [iTMSTransporter] Caused by: java.lang.NullPointerException
[10:01:44]: [iTMSTransporter] 	at com.apple.transporter.bootstrap.BootstrapperPhase2.bootstrapBundles(BootstrapperPhase2.java:284)
[10:01:44]: [iTMSTransporter] 	at com.apple.transporter.bootstrap.BootstrapperPhase2.start(BootstrapperPhase2.java:163)
[10:01:44]: [iTMSTransporter] 	at com.apple.transporter.bootstrap.BootstrapperPhase1.startOSGiFramework(BootstrapperPhase1.java:399)
[10:01:44]: [iTMSTransporter] 	at com.apple.transporter.bootstrap.BootstrapperPhase1.realBootstrap(BootstrapperPhase1.java:225)
[10:01:44]: [iTMSTransporter] 	at com.apple.transporter.bootstrap.BootstrapperPhase1.bootstrap(BootstrapperPhase1.java:86)
[10:01:44]: [iTMSTransporter] 	... 13 more
[10:01:44]: iTunes Transporter output above ^
[10:01:44]: could not download
The call to the iTMSTransporter completed with a non-zero exit status: 1. This indicates a failure.
+--------------------+----------------------------------------------------------------------+
|                                       Lane Context                                        |
+--------------------+----------------------------------------------------------------------+
| DEFAULT_PLATFORM   | ios                                                                  |
| PLATFORM_NAME      | ios                                                                  |
| LANE_NAME          | ios export_ipa                                                       |
| IPA_OUTPUT_PATH    | /Users/mxgx/Documents/GitHub/JJCComicBook/Code/JJCComicBook/fastlan  |
|                    | e/package/JJCComicBook.ipa                                           |
| XCODEBUILD_ARCHIVE | /Users/mxgx/Library/Developer/Xcode/Archives/2022-05-07/JJCComicBoo  |
|                    | k 2022-05-07 09.55.29.xcarchive                                      |
| DSYM_OUTPUT_PATH   | /Users/mxgx/Documents/GitHub/JJCComicBook/Code/JJCComicBook/fastlan  |
|                    | e/package/JJCComicBook.app.dSYM.zip                                  |
+--------------------+----------------------------------------------------------------------+
[10:01:45]: Error uploading ipa file: 
+------+---------------------------+-------------+
|                fastlane summary                |
+------+---------------------------+-------------+
| Step | Action                    | Time (in s) |
+------+---------------------------+-------------+
| 1    | default_platform          | 0           |
| 2    | gym                       | 368         |
| 3    | notification              | 0           |
| 4    | app_store_connect_api_key | 0           |
| 💥   | upload_to_testflight      | 11          |
+------+---------------------------+-------------+
[10:01:45]: fastlane finished with errors
[!] Error uploading ipa file: 
```
![Fastlane - 上传 TestFlight 失败](/images/iOS/2022-05-07-Fastlane-08.png)

虽然从网上查找好多，都是说是因为网络或防火墙引起的（比如：[Stackoverflow - Fastlane upload_to_testflight The call to the iTMSTransporter completed with a non-zero exit status: 1. This indicates a failure](https://stackoverflow.com/questions/66059470/fastlane-upload-to-testflight-the-call-to-the-itmstransporter-completed-with-a-n)），但是实际上无论切换网络还是关闭防火墙，都没有解决问题。

而有的则是说需要在 `fane` action 前加一些变量（比如：[Stackoverflow - Fabric Fastlane Pilot Upload iTMSTransporter failure](https://stackoverflow.com/questions/45189547/fabric-fastlane-pilot-upload-itmstransporter-failure)），实际上也是没有解决问题。

最终解决的办法是移除对应的 `iTMSTransporter` 相关文件，再次执行指令就可以了。
参考链接：
- [Stackoverflow - iTunes Transporter error: Could not resolve module: com.apple.transporter.starter](https://stackoverflow.com/questions/70950473/itunes-transporter-error-could-not-resolve-module-com-apple-transporter-starte)
- [Apple Developer - Transporter error after home folder renaming](https://developer.apple.com/forums/thread/129378?answerId=419847022#419847022)

解决办法如下：

```swift
/// 优先删除如下文件夹，然后再次执行编译
~/Library/Caches/com.apple.amp.itmstransporter
/// 如果上面的方式不行，则执行下面
~Library/Caches/com.apple.TransporterApp
~Library/Preferences/com.apple.TransporterApp.plist
~Library/Application Support/com.apple.TransporterApp
```
![Fastlane - 上传 TestFlight 成功](/images/iOS/2022-05-07-Fastlane-09.png)

#### 报错：[!] Unresolved conflict between options: 'api_key' and 'username'

这是由于在配置 `fastlane` 上传 `TestFlight` 时，同时配置了 `key_id` 和 `username、app_identifier` 两个参数引起的，两者不能同时存在，只能单独配置一者，只需要删除其中一个就行了。

#### 报错：Error loading plugin 'fastlane-plugin-pgyer': Permission denied @ rb_sysopen - /usr/local/lib/ruby/gems/2.7.0/cache/fastlane-plugin-pgyer-0.2.2.gem

如果直接使用 `fastlane add_plugin pgyer` 指令的话，有时候会报如下错误：

```swift
Fetching fastlane-plugin-pgyer-0.2.2.gem
#<Thread:0x00007fc49e857478 /usr/local/Cellar/ruby/2.7.1_2/lib/ruby/2.7.0/rubygems/request_set.rb:168 run> terminated with exception (report_on_exception is true):
Traceback (most recent call last):
	8: from /usr/local/Cellar/ruby/2.7.1_2/lib/ruby/2.7.0/rubygems/request_set.rb:174:in `block (2 levels) in install'
	7: from /usr/local/Cellar/ruby/2.7.1_2/lib/ruby/2.7.0/rubygems/resolver/specification.rb:101:in `download'
	6: from /usr/local/Cellar/ruby/2.7.1_2/lib/ruby/2.7.0/rubygems/source.rb:207:in `download'
	5: from /usr/local/Cellar/ruby/2.7.1_2/lib/ruby/2.7.0/rubygems/remote_fetcher.rb:154:in `download'
	4: from /usr/local/Cellar/ruby/2.7.1_2/lib/ruby/2.7.0/rubygems/remote_fetcher.rb:306:in `cache_update_path'
	3: from /usr/local/Cellar/ruby/2.7.1_2/lib/ruby/2.7.0/rubygems.rb:885:in `write_binary'
	2: from /usr/local/Cellar/ruby/2.7.1_2/lib/ruby/2.7.0/open-uri.rb:21:in `open'
	1: from /usr/local/Cellar/ruby/2.7.1_2/lib/ruby/2.7.0/open-uri.rb:21:in `open'
/usr/local/Cellar/ruby/2.7.1_2/lib/ruby/2.7.0/open-uri.rb:21:in `initialize': Permission denied @ rb_sysopen - /usr/local/lib/ruby/gems/2.7.0/cache/fastlane-plugin-pgyer-0.2.2.gem (Errno::EACCES)
[14:42:01]: Error loading plugin 'fastlane-plugin-pgyer': Permission denied @ rb_sysopen - /usr/local/lib/ruby/gems/2.7.0/cache/fastlane-plugin-pgyer-0.2.2.gem
+-----------------------+-----------+------------------+
|                     Used plugins                     |
+-----------------------+-----------+------------------+
| Plugin                | Version   | Action           |
+-----------------------+-----------+------------------+
| fastlane-plugin-fir   | 0.3.0     | fir              |
| fastlane-plugin-pgyer | undefined | No actions found |
+-----------------------+-----------+------------------+

[!] No actions were found while loading one or more plugins
    Please use `bundle exec fastlane` with plugins
    More info - https://docs.fastlane.tools/plugins/using-plugins/#run-with-plugins
```

![Fastlane - 安装 pgyer 插件失败](/images/iOS/2022-05-07-Fastlane-10.png)

而当添加 `sudo` 管理员权限的指令后，就可以安装成功了。

```swift
{22-05-06 14:42}mxgx:~/FastlaneDemo mxgx% sudo fastlane add_plugin pgyer
Password:
[✔] 🚀 
[14:42:34]: fastlane detected a Gemfile in the current directory
[14:42:34]: However, it seems like you didn't use `bundle exec`
[14:42:34]: To launch fastlane faster, please use
[14:42:34]: 
[14:42:34]: $ bundle exec fastlane add_plugin pgyer
[14:42:34]: 
[14:42:34]: Get started using a Gemfile for fastlane https://docs.fastlane.tools/getting-started/ios/setup/#use-a-gemfile
[14:42:37]: Installing Ruby gem 'fastlane-plugin-pgyer'...
Fetching fastlane-plugin-pgyer-0.2.2.gem
[14:42:39]: Successfully installed 'fastlane-plugin-pgyer'
+-----------------------+---------+--------+
|               Used plugins               |
+-----------------------+---------+--------+
| Plugin                | Version | Action |
+-----------------------+---------+--------+
| fastlane-plugin-fir   | 0.3.0   | fir    |
| fastlane-plugin-pgyer | 0.2.2   | pgyer  |
+-----------------------+---------+--------+
```

#### 报错：Permission denied @ rb_sysopen - /usr/local/lib/ruby/gems/2.7.0/cache/admqr_knife-0.1.5.gem (Errno::EACCES)

由于使用 `gem install fir-cli` 安装 `fir` 自动上传 `CI` 时权限引发的，使用如下指令即可：

```swift
sudo gem install fir-cli
/// 或
sudo gem install -n /usr/local/bin fir-cli
```

#### 报错：Could not find action, lane or variable 'xxx'

表示未查询到对应的 `plugin` 插件，需要重新下载，可以通过 `fastlane action` 查询当前已经安装的插件，如果没有对应的插件，则重新安装即可。

#### 报错：其他报错 1

如果报如下错误，基本上都是 `Appflie` 或 `Fastfile` 文件配置不正确，需要仔细核查：

```swift
+------------------+----------------+
|           Lane Context            |
+------------------+----------------+
| DEFAULT_PLATFORM | iOS            |
| PLATFORM_NAME    | iOS            |
| LANE_NAME        | iOS hs_release |
+------------------+----------------+
[11:01:40]: Error building the application - see the log above

+------+------------------+-------------+
|           fastlane summary            |
+------+------------------+-------------+
| Step | Action           | Time (in s) |
+------+------------------+-------------+
| 1    | default_platform | 0           |
| 💥   | gym              | 15          |
+------+------------------+-------------+

[11:01:41]: fastlane finished with errors

[!] Error building the application - see the log above
```

#### 报错：其他报错 2

如果报如下错误，暂时没找到解决办法：

```swift
2022-05-05 11:01:34.455 xcodebuild[44781:25956942] Requested but did not find extension point with identifier Xcode.IDEKit.ExtensionSentinelHostApplications for extension Xcode.DebuggerFoundation.AppExtensionHosts.watchOS of plug-in com.apple.dt.IDEWatchSupportCore
2022-05-05 11:01:34.456 xcodebuild[44781:25956942] Requested but did not find extension point with identifier Xcode.IDEKit.ExtensionPointIdentifierToBundleIdentifier for extension Xcode.DebuggerFoundation.AppExtensionToBundleIdentifierMap.watchOS of plug-in com.apple.dt.IDEWatchSupportCore
```